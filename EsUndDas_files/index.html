<!DOCTYPE html>
<!-- saved from url=(0049)https://apps.rokt.com/wsdk2/controller/index.html -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta http-equiv="Content-Security-Policy" content="base-uri &#39;self&#39;; object-src &#39;none&#39;; script-src &#39;self&#39; https://apps.rokt.com &#39;sha256-1IlY23qD/u05SSIrNO+NoNQYX6xIGqmJtGr+JXBFMdY=&#39;; style-src &#39;self&#39;; default-src &#39;none&#39;; frame-src &#39;self&#39; https://apps.rokt.com; connect-src &#39;self&#39; https://apps.rokt.com https://apps-demo.rokt.com; img-src &#39;self&#39; data:">
    
    <title>Rokt - Controller</title>
    <!--<base href="./">--><base href=".">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="icon" href="data:;base64,=">
  </head>
  <body><script type="module">(()=>{var t={616:t=>{self,t.exports=(()=>{"use strict";var t={d:(e,s)=>{for(var i in s)t.o(s,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:s[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"_",{value:!0})}},e={};t.r(e),t.d(e,{ERROR_LIMIT:()=>s,reportError:()=>r});const s=10;let i=0,n=!1;const r=async t=>{var e;if(t.handled)return;if(!t.bypassErrorLimit&&i>=s){if(n)return;t.code="ERROR_LIMIT_EXCEEDED",n=!0}i++;const r=(1e7*Math.random()).toFixed(0).toString(),o=function(t,e){var s;const i=new URLSearchParams;return i.append("error_id",e),i.append("use_sandbox",(null===(s=t.useSandbox)||void 0===s?void 0:s.toString())||"false"),i.append("partner_origin",window.location.origin),i.append("rokt_tag_id",t.tagId||""),i.append("severity",t.severity||"WARNING"),i.append("reporter",t.reporter?`frame-${t.reporter}`:"frame"),t.code&&i.append("code",t.code),t.integration&&i.append("integration",t.integration),t.stack&&i.append("stack",t.stack.substring(0,400)),t.additionalInformation=Object.assign({name:t.name,message:t.message},t.additionalInformation),i.append("additional_information",JSON.stringify(t.additionalInformation)),i}(t,r),a=document.createElement("iframe");a.src=`https://apps.rokt.com/wsdk2/reporter/index.html?${o.toString()}`,a.style.display="none";const c=new Promise((t=>{const e=s=>{var i,n,o;"Rokt.Reporter.Close"!==(null===(i=s.data)||void 0===i?void 0:i.action)&&(null===(o=null===(n=s.data)||void 0===n?void 0:n.payload)||void 0===o?void 0:o.errorId)!==r||(t(),window.removeEventListener("message",e))};window.addEventListener("message",e)}));(window.document.body||window.document.head).appendChild(a),await c,null===(e=a.parentElement)||void 0===e||e.removeChild(a)};return e})()}},e={};function s(i){var n=e[i];if(void 0!==n)return n.exports;var r=e[i]={exports:{}};return t[i](r,r.exports,s),r.exports}(()=>{"use strict";const t="lax",e="none",i="strict";class n{constructor(t){this.window=t}getCookie(t){try{const e=this.window.document.cookie.match(new RegExp("(^| )"+t+"=([^;]+)"));if(e)return e[2]}catch(t){}}setCookie(t,e=!1){try{e&&(t.domain=this.getBaseDomain()),this.window.document.cookie=this.serialize(t)}catch(t){}}getBaseDomain(){const t=this.window.location.hostname,e=t.split("."),s=e.pop(),i=e.pop();return i&&s?`.${i}.${s}`:t}serialize(t){const{name:e,path:s="/",sameSite:i,secure:n,value:r,domain:o}=t;let{expires:a}=t;if(!a){const t=new Date;t.setTime(t.getTime()+31536e6),a=t}let c=`${e}=${r};expires=${a.toUTCString()};path=${s}`;return o&&(c+=`;domain=${o}`),n&&(c+=";secure"),i&&(c+=`;samesite=${i}`),c}}const r="NO_WINDOW",o=()=>{if("undefined"==typeof window)throw new Error(r);return window};class a{constructor(t,e="local"){this.window=t,this.ut="session"===e?"sessionStorage":"localStorage"}getItem(t){try{const e=this.window[this.ut].getItem(t);if(null===e)return;return e}catch(t){return}}setItem(t,e){try{this.window[this.ut].setItem(t,e)}catch(t){}}}class c extends a{constructor(t){super(t,"local")}}class h extends a{constructor(t){super(t,"session"),this.persistentMemoryMap=new Map}getItem(t){try{let e=super.getItem(t);return void 0!==e?e:(e=this.persistentMemoryMap.get(t),null!=e?(super.setItem(t,e),e):void 0)}catch(t){return}}setItem(t,e){try{this.persistentMemoryMap.set(t,e),super.setItem(t,e)}catch(t){}}}const u={ERROR:"ERROR",INFO:"INFO",WARNING:"WARNING"};class l extends Error{constructor(t){var e,s;super(t.code),this.name=null!==(e=t.name)&&void 0!==e?e:this.name,this.message=t.message||t.code||"",this.code=t.code,this.additionalInformation=t.additionalInformation,this.handled=null!==(s=t.handled)&&void 0!==s&&s,this.severity=t.severity||u.ERROR,this.integration=t.integration,this.reporter=t.reporter,t.stack&&(this.stack=t.stack)}}const d={EVENT_RESPONSE:"EVENT_RESPONSE",UNKNOWN_ERROR:"UNKNOWN_ERROR",UNHANDLED_EXCEPTION:"UNHANDLED_EXCEPTION",ERROR_LIMIT_EXCEEDED:"ERROR_LIMIT_EXCEEDED",WARNING_LIMIT_EXCEEDED:"WARNING_LIMIT_EXCEEDED",EXPERIENCES_CALL_FAILED:"EXPERIENCES_CALL_FAILED",SESSION_LIMIT_EXCEEDED:"SESSION_LIMIT_EXCEEDED",LAUNCHER_VERSION:"LAUNCHER_VERSION",TERMINATE_FAILED:"TERMINATE_FAILED",CONTROLLER_CONNECTION_TIMEOUT:"CONTROLLER_CONNECTION_TIMEOUT",LATE_CONTROLLER_CONNECTION:"LATE_CONTROLLER_CONNECTION",PLUGIN_INITIALIZATION_TIMEOUT:"PLUGIN_INITIALIZATION_TIMEOUT",INVALID_METRICS:"INVALID_METRICS",METRICS_REQUEST_FAILED:"METRICS_REQUEST_FAILED",SELECTION_MADE_FOR_CONVERSION:"SELECTION_MADE_FOR_CONVERSION",HASHING_FAILED:"HASHING_FAILED",PAGE_IDENTIFIER_DOES_NOT_EXIST:"PAGE_IDENTIFIER_DOES_NOT_EXIST",SELECTOR_ELEMENT_NOT_FOUND:"SELECTOR_ELEMENT_NOT_FOUND",ROKT_FIRST_TOUCH_NOT_SET:"ROKT_FIRST_TOUCH_NOT_SET",ROKT_COOKIES_FAILED:"ROKT_COOKIES_FAILED",ROKT_LOCALSTORAGE_FAILED:"ROKT_LOCALSTORAGE_FAILED",PLUGIN_ALREADY_APPENDED:"PLUGIN_ALREADY_APPENDED",EXTENSION_INITIALIZATION:"EXTENSION_INITIALIZATION",EXTENSION_SELECTION_ERROR:"EXTENSION_SELECTION_ERROR",PLUGIN_MISSIZED:"PLUGIN_MISSIZED",PLUGIN_COVERED:"PLUGIN_COVERED",PLUGIN_COVERED_FULL:"PLUGIN_COVERED_FULL",GET_PARTNER_LAUNCHER_EXTENSION:"GET_PARTNER_LAUNCHER_EXTENSION"},w={code:d.UNKNOWN_ERROR,severity:u.ERROR};function f(t,e={}){const s=Object.assign(Object.assign({},w),e);if((i=t)&&"object"==typeof i){const e=t;e.name&&(s.name=e.name),e.message&&(s.message=e.message),e.stack&&(s.stack=e.stack),e.code&&(s.code=e.code),e.reporter&&(s.reporter=e.reporter),e.integration&&(s.integration=e.integration),e.severity&&(s.severity=e.severity),void 0!==e.handled&&(s.handled=e.handled),e.additionalInformation&&(s.additionalInformation=Object.assign(Object.assign({},s.additionalInformation),e.additionalInformation))}var i;return new l(s)}const E="rtid",m="RoktTransactionId",p="DISPLAY_SETTINGS_SET",y={CONTROLLER_FRAME_LOAD:"CONTROLLER_FRAME_LOAD",ETAG_REQUEST:"ETAG_REQUEST",INVALID_NEXT_JOURNEY_STAGE:"INVALID_NEXT_JOURNEY_STAGE",JOURNEY_NOT_INITIALISED:"JOURNEY_NOT_INITIALISED",METHOD_SELECTION_UNSUBSCRIBE:"METHOD_SELECTION_UNSUBSCRIBE",PLACEMENT_NOT_FOUND:"PLACEMENT_NOT_FOUND",PUT_STYLES:"PUT_STYLES",REQUEST_ERROR:"REQUEST_ERROR",RESIZE_DETECTION:"RESIZE_DETECTION",SANDBOX_ATTRIBUTES:"SANDBOX_ATTRIBUTES",SET_TITLE:"SET_TITLE",V1_METRIC_FAILURE:"V1_METRIC_FAILURE",URL_CHILD_PLUGIN_CREATED:"URL_CHILD_PLUGIN_CREATED"};var v=s(616);const g="userAgent",S="clientType",_="passbackconversiontrackingid",T="preload",I="SIMULTANEOUS_SELECTION",O="ATTRIBUTES_CAPTURE",b="ATTRIBUTES_CAPTURE_FAILURE",N="PAGE_ID_UPDATED",R="PAGE_INSTANCE_GUID_UPDATED",P="PAGE_VARIANT_NAME_UPDATED",A="SESSION_ID_UPDATED",C="SESSION_INFORMATION_UPDATED";class D{constructor(t){this.lt=t,this.dt=["HASHING_FAILED"],this.wt=this.ft,this.lt.onerror=(...t)=>{const e=t[D.Et];return this.yt(e),!0},this.lt.addEventListener("unhandledrejection",(({reason:t})=>{this.yt(t)}))}set(t){this.wt=t}yt(t){let e=t;t&&(t instanceof Error||t.code)||(e=new l({message:JSON.stringify(t)})),this.vt(e)||(e.code||(e.code=d.UNHANDLED_EXCEPTION),e.reporter="global",this.wt(e))}vt(t){return!!this.dt.includes(t.code)||t.integration===T&&t.severity===u.INFO}ft(t){(0,v.reportError)(Object.assign(Object.assign({},t),{message:t.message,name:t.name,tagId:"",stack:t.stack}))}}D.Et=4;const L=()=>{const t=o();"true"==="false".toLowerCase()&&(0,v.reportError)({message:y.CONTROLLER_FRAME_LOAD,name:y.CONTROLLER_FRAME_LOAD,code:y.CONTROLLER_FRAME_LOAD,severity:u.INFO,tagId:"",additionalInformation:{controllerFrameName:t.name}}),t.roktReporter=new D(t)};class M{constructor(){this.fulfilled=!1,this.rejected=!1,this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e})).then((t=>(this.fulfilled=!0,t)),(t=>{throw this.rejected=!0,t}))}isFulfilled(){return this.fulfilled}isPending(){return!this.isFulfilled()&&!this.isRejected()}isRejected(){return this.rejected}static resolve(t){const e=new M;return e.resolve(t),e}}const x=(t=0)=>new Promise((e=>setTimeout(e,t))),k=()=>{let t="";for(let e=0;e<10;e++)t+="abcdefghijklmnopqrstuvwxyz".charAt(Math.floor(26*Math.random()));return t};class U{constructor(){this.t=[]}add(t){this.t.push(t)}unsubscribe(){this.t.forEach((t=>t.unsubscribe()))}}const j=()=>{},$=(t=j,e=j,s=j)=>"function"!=typeof t?t:{next:t,error:e,complete:s};class G{constructor(t){this.i=t}subscribe(t,e,s){const i=$(t,e,s);let n,r=!0;const o={next:t=>{r&&i.next(t)},complete:()=>{r&&(n&&n(),i.complete(),r=!1)},error:t=>{r&&(i.error(t),r=!1)}};n=this.i(o),r||n&&n();const a=new U;return a.add({unsubscribe:()=>{n&&n(),r=!1}}),a}}class F extends G{constructor(){super((t=>(this.o&&t.complete(),this.h.push(t),()=>this.h=this.h.filter((e=>e!==t))))),this.h=[],this.o=!1}next(t){for(const e of this.h)e.next(t)}error(t){for(const e of this.h)e.error(t)}complete(){this.o=!0;for(const t of this.h)t.complete()}asObservable(){return new G((t=>{const e=this.subscribe(t);return()=>e.unsubscribe()}))}}var W,V;!function(t){t[t.Host=0]="Host",t[t.Plugin=1]="Plugin",t[t.Extension=2]="Extension"}(W||(W={})),function(t){t.AddChild="internal:add-child",t.RemoveChild="internal:remove-child"}(V||(V={}));class B{constructor(t,e,s,i=null,n=null){this.id=t,this.name=e,this.type=s,this.element=i,this.windowRef=n,this.children=[],this.events$=new F,this.parent=null,this.unsubscribers=[]}appendChild(t){t.parent=this,this.children.push(t),this.events$.next({source:t,type:V.AddChild,data:void 0})}removeChild(t){const e=this.children.indexOf(t);-1!==e&&(this.children.splice(e,1),t.parent=null)}}class H{constructor(t){this.value=t,this.complete=!1,this.skip=!1}}const K=t=>(...e)=>new G((s=>{const i=t.subscribe((t=>function(t,e,s,i){return new(s||(s=Promise))((function(n,r){function o(t){try{c(i.next(t))}catch(t){r(t)}}function a(t){try{c(i.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(o,a)}c((i=i.apply(t,e||[])).next())}))}(void 0,void 0,void 0,(function*(){try{let i=new H(t);for(const t of e){const e=t(i);if(i=e.then?yield e:e,!0===i.skip||!0===i.complete)break}if(i.skip)return;s.next(i.value),!0===i.complete&&s.complete()}catch(t){s.error(t)}}))),(t=>s.error(t)),(()=>s.complete()));return()=>i.unsubscribe()})),X=t=>e=>(!1===t(e.value)&&(e.skip=!0),e),Y=t=>e=>{const s=t(e.value);return new H(s)};class z{constructor(t,e){this.u=t,this.l=e,this.p=K(this.u.events$)(X((t=>t.source===e)),Y((t=>({eventName:t.type,data:t.data}))))}send(t,e){this.l.events$.next({source:this.u,type:t,data:e})}on(t){return"*"===t?this.p:K(this.p)(X((e=>e.eventName===t)),Y((t=>t.data)))}}var q;!function(t){t.Controller="Controller",t.Extension="Extension",t.Launcher="Launcher",t.Plugin="Plugin"}(q||(q={}));class J extends Error{constructor(t){super(t.message||t.code),this.code=t.code,this.sourceType=t.sourceType,this.sourceName=t.sourceName,t.stack&&(this.stack=t.stack)}}const Z={LAUNCHER_EXTENSION_UNDEFINED:"LAUNCHER_EXTENSION_UNDEFINED",EXTENSION_INITIALISATION_FAILED:"EXTENSION_INITIALISATION_FAILED",COULD_NOT_FIND_NODE:"COULD_NOT_FIND_NODE",POST_MESSAGE_CONNECTION_ERROR:"POST_MESSAGE_CONNECTION_ERROR"},Q=(t,e,s=null,i=null)=>new B(t,e,W.Plugin,i,s),tt="internal:put-config",et="internal:close",st="internal:method",it="internal:appended";var nt;function rt(t,e){return{close:async()=>{t.next({source:e,type:et,data:void 0})},onAppended:async()=>{t.next({source:e,type:it,data:void 0})},putConfig:async s=>{t.next({source:e,type:tt,data:s})},sendMessage:async(s,i)=>{t.next({source:e,type:s,data:i})}}}!function(t){t.PutConfigEvent="internal:put-config",t.ClosePluginEvent="internal:close",t.MethodEvent="internal:method",t.Initiate="internal:appended"}(nt||(nt={}));var ot,at;!function(t){t.LifeCycle="internal:lifecycle",t.Close="internal:close"}(ot||(ot={})),function(t){t.BeforeInit="internal:before-init",t.AfterInit="internal:after-init",t.Closed="internal:closed"}(at||(at={}));var ct,ht,ut,lt=function(t,e,s,i,n){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!n:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?n.call(t,s):n?n.value=s:e.set(t,s),s},dt=function(t,e,s,i){if("a"===s&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?i:"a"===s?i.call(t):i?i.value:e.get(t)};class wt{constructor(t,e){ct.set(this,new F),ht.set(this,void 0),ut.set(this,void 0),lt(this,ht,t,"f"),lt(this,ut,e,"f")}throw(t,e="",s){throw new J({code:t,stack:s,message:e,sourceType:dt(this,ht,"f"),sourceName:dt(this,ut,"f")})}onError(){return dt(this,ct,"f").asObservable()}reportError(t){const e=Object.assign({message:t.message,stack:t.stack},t);dt(this,ct,"f").next(e)}createCoreError(t,e="",s){return new J({code:t,stack:s,message:e||t,sourceType:dt(this,ht,"f"),sourceName:dt(this,ut,"f")})}}ct=new WeakMap,ht=new WeakMap,ut=new WeakMap;const ft=t=>`core:extension-registered-${t}`;class Et{constructor(){this.fulfilled=!1,this.rejected=!1,this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e})).then((t=>(this.fulfilled=!0,t)),(t=>{throw this.rejected=!0,t}))}isFulfilled(){return this.fulfilled}isPending(){return!this.isFulfilled()&&!this.isRejected()}isRejected(){return this.rejected}static resolve(t){const e=new Et;return e.resolve(t),e}}var mt,pt;!function(t){t[t.BeforeInit=0]="BeforeInit",t[t.AfterInit=1]="AfterInit",t[t.Closed=2]="Closed"}(mt||(mt={}));class yt{constructor(t,e){this.pluginNode=t,this.lifecycleStage=e;const s=new F,i=new F;this.close$=s.asObservable(),this.afterInit$=i.asObservable(),e===at.AfterInit?this.m=mt.AfterInit:this.m=mt.BeforeInit;const n=t.events$.subscribe((e=>{e.source===t&&(e.type===ot.LifeCycle&&e.data===at.AfterInit&&(this.m=mt.AfterInit,i.next(),i.complete()),e.type===ot.Close&&(n.unsubscribe(),this.m=mt.Closed,s.next(),s.complete()))}))}async getCurrentStage(){return this.m}}!function(t){t.Use="internal:use",t.Method="internal:method"}(pt||(pt={}));class vt{constructor(t,e){this.v=t,this.g=e}method(t,e){K(this.v.events$)(X((t=>t.source===this.g)),X((t=>t.type===pt.Method)),X((e=>e.data.methodName===t))).subscribe((async t=>{const{ref:s,args:i}=t.data,n=await e(...i);this.g.events$.next({source:this.v,type:st,data:{result:n,ref:s}})}))}}class gt{constructor(t,e,s){this.v=t,this.g=e,this.lifecycleStage=s,this.id="",this.name="",this.register=new vt(this.v,this.g),this.lifecycle=new yt(this.g,s),this.events$=K(this.v.events$)(X((t=>t.source===this.g)),X((t=>!Object.values(pt).includes(t.type))),Y((({type:t,data:e})=>({eventName:t,data:e}))))}async send(t,e){this.g.events$.next({source:this.v,type:t,data:e})}on(t){return K(this.events$)(X((e=>e.eventName===t)),Y((t=>t.data)))}}class St{constructor(t){this.N=new Et,this.O=new Et,this.pluginConnected$=K(t.events$)(X((t=>t.type===pt.Use)),Y((e=>new gt(t,e.source,e.data))))}definePluginInterface(t){this.O.resolve(t)}defineLauncherInterface(t){this.N.resolve(t)}getLauncherInterface(){return this.N.promise}getPluginInterface(){return this.O.promise}}const _t=async(t,e,s)=>{const i=t.document.createElement("script");i.src=`../extensions/${e}/index.js`;const n=new Promise(((s,n)=>{i.onerror=n;const r=(t=>`core:extension-register-${t}`)(e),o=e=>{t.removeEventListener(r,o),s(e.detail)};t.addEventListener(r,o)})).catch((t=>{const i=s.createCoreError(Z.EXTENSION_INITIALISATION_FAILED,`EXTENSION ${e} FAILED`,t.stack);s.reportError(i)}));t.document.head.appendChild(i),await n};async function Tt(t,e,s,i,n){const r=s.get(i);if(r)return r;const o=new wt(q.Extension),a=new B(k(),i,W.Extension),c=new St(t),h=o.onError().subscribe((t=>{n.reportError(t)}));return t.unsubscribers.push(h),s.set(i,[a,c]),await _t(e,i,o),function(t,e,s){const i=new CustomEvent(ft(e),{detail:s});t.dispatchEvent(i)}(e,i,c),[a,c]}class It extends Map{}const Ot=(t,e)=>{const s=[];for(let i=0;i<e.length;i++)try{if(t===e[i])continue;e[i].origin===t.location.origin&&s.push(e[i],...Ot(t,e[i]))}catch(t){}return s};class bt{constructor(t,e){this.I=t,this.T=e,this.id=this.T.id,this.events$=K(t.events$)(X((t=>t.source===this.T)),Y((t=>({eventName:t.type,data:t.data}))))}async send(t,e){this.T.events$.next({source:this.I,type:t,data:e})}on(t){return K(this.events$)(X((e=>e.eventName===t||"*"===t)),Y((t=>t.data)))}}class Nt{constructor(t,e,s,i,n,r){this.I=t,this.T=e,this.S=s,this.C=i,this.P=n,this.R=r,this.id=t.id,this.events$=K(e.events$)(X((t=>t.source===this.I)),Y((t=>({eventName:t.type,data:t.data})))),this.j=new Et}async send(t,e){this.I.events$.next({source:this.T,type:t,data:e})}on(t){return K(this.events$)(X((e=>e.eventName===t)),Y((t=>t.data)))}onClose(){return this.j.promise}async putConfig(t){this.I.events$.next({source:this.T,type:tt,data:t})}async close(){var t;this.T.removeChild(this.I),await(null===(t=this.gt)||void 0===t?void 0:t.close())}async appendToHostSelector(t){const e=await this.C.createChildHostPlugin(this.I,this.T,this.P,this.R,this.S);this.gt=e,this.gt.onClose().then(this.j.resolve),e.parent=new bt(this.I,this.T),await e.appendTo(t)}async appendToParentSelector(t){const e=await this.C.createChildInternalPlugin(this.I,this.T,this.P,this.R,this.S);this.gt=e,this.gt.onClose().then(this.j.resolve),e.parent=new bt(this.I,this.T),await e.appendTo(t)}}class Rt extends G{constructor(t,e,s,i){super((i=>(i.next(this.A),this.h.push(i),1===this.h.length&&this.$(t,e,s),()=>{var t;this.h=this.h.filter((t=>t!==i)),0===this.h.length&&(null===(t=this.D)||void 0===t||t.unsubscribe())}))),this.A=i,this.h=[],this.D=null}$(t,e,s){this.D=K(e.events$)(X((e=>e.source===t||e.source===s)),X((t=>t.type===tt))).subscribe((t=>{this.A=t.data,this.h.forEach((t=>{t.next(this.A)}))}))}}class Pt{constructor(t,e,s,i){this.k=t,this.L=e,this.M=s,this.F=i,this.U=new F}async setFullscreen(){await this.k.setFullscreen(this.F)}setStyles(t){throw new Error("to be implemented")}async setSandboxAttributes(t){await this.M.setSandboxAttributes(t)}async setTitle(t){await this.M.setTitle(t)}async enableResizeDetection(){const t=this.L.windowRef;await this.setHeight(t),this.H=new t.ResizeObserver((async()=>{await this.setHeight(t),this.U.next({height:t.document.documentElement.offsetHeight,width:t.document.body.clientWidth})})),this.H.observe(t.document.body)}async disableResizeDetection(){this.H&&this.H.disconnect()}async putStyles(t){await this.M.putStyles(t)}async setHighestZIndex(){const t=await this.k.getHighestZIndex()+1;await this.M.putStyles({zIndex:`${t}`})}async clearStyles(){await this.M.clearStyles()}onResizeDetection(){return this.U.asObservable()}async setHeight(t){await this.putStyles({height:`${t.document.documentElement.offsetHeight}px`})}}class At{constructor(t,e,s){this.g=t,this.v=e,this.lifecycleStage=s,this.events$=K(t.events$)(X((t=>t.source===e)),X((t=>t.type!==st)),Y((t=>({eventName:t.type,data:t.data})))),this.send(pt.Use,{lifecycleStage:s})}async send(t,e){this.v.events$.next({source:this.g,type:t,data:e})}on(t){return K(this.events$)(X((e=>e.eventName===t)),Y((t=>t.data)))}async runMethod(t,e){const s=k(),i=((t,e)=>{let s;return new Promise(((e,i)=>{s=t.subscribe(e,i,(()=>{i(new Error("CompletedBeforeEmit"))}))})).finally((()=>s.unsubscribe()))})(K(this.g.events$)(X((t=>t.source===this.v)),X((t=>t.type===st)),X((t=>t.data.ref===s)),Y((t=>t.data.result))));return this.v.events$.next({source:this.g,type:pt.Method,data:{methodName:t,args:e,ref:s}}),await i}}class Ct{constructor(t,e,s,i,n,r,o,a,c,h,u,l){this.launcherDisplay=t,this.G=e,this.g=s,this.W=r,this.Y=o,this.C=a,this.B=c,this.M=h,this.X=u,this.P=l,this.parent=null,this.m=at.BeforeInit,this.j=new Et,this.q=new Et,this.id=s.id,this.name=s.name,this.cssSelector=this.Z(s.id),this.config$=new Rt(e,s,i,n),this.display=new Pt(t,s,h,this.cssSelector),this.launcherCommunication=l;const d=(w=this.g,f=this.G,E=this.X,function t(e){return e.parent||E.throw(Z.COULD_NOT_FIND_NODE),e.parent===f?e:t(e.parent)}(w));var w,f,E;this.controllerCommunication=new z(d,this.G),this.pluginCommunication=new z(this.G,d),this.g.unsubscribers.push(K(this.g.events$)(X((t=>t.type===it))).subscribe((()=>this.J()))),this.g.unsubscribers.push(K(this.g.events$)(X((t=>t.type===et))).subscribe((()=>{this.close()})))}async createChild({name:t,e2eId:e,config:s}){const i=k(),n=Q(i,t);return new Nt(n,this.g,s,this.C,this.P,null!=e?e:"")}async close(){var t;this.m!==at.Closed&&(this.m=at.Closed,[...this.g.children].forEach((t=>{t.events$.next({source:t,type:et,data:void 0})})),this.g.unsubscribers.forEach((t=>{t.unsubscribe()})),this.g.unsubscribers.splice(0),null===(t=this.g.parent)||void 0===t||t.removeChild(this.g),this.M.close(),this.display.disableResizeDetection(),this.j.resolve())}async onClose(){await this.j.promise}async useExtension(t){const[e]=await Tt(this.G,this.W,this.Y,t,this.X),s=new At(this.g,e,this.m);return i=["on","send"],n=["events$"],new Proxy(s,{get:(t,e)=>"then"===e?null:n.includes(e)?t[e]:i.includes(e)?t[e].bind(t):(...s)=>t.runMethod(e,s)});var i,n}async init(){await this.M.putStyles({display:"block"}),this.m=at.AfterInit,this.g.events$.next({source:this.g,type:ot.LifeCycle,data:this.m})}async appendTo(t,e="beforeend"){await this.M.appendTo(t,e)}getPluginWindowRef(){return this.q.promise}J(){const t=((t,e)=>{const s=Ot(t,t.parent.frames);for(const t of s)if(t.name===e)return t})(this.W,this.id);if(t){this.g.windowRef=t,this.q.resolve(t);((t,e)=>{t.dispatchEvent(new CustomEvent("core:library-load",{detail:e}))})(t,this.B(this))}else this.q.resolve(void 0),this.X.throw("IFRAME_NOT_FOUND")}Z(t){return`iframe[id="${t}"]`}}class Dt{constructor(t){this.K=t}async appendTo(t,e){await this.K.appendTo(t,e)}async clearStyles(){await this.K.clearStyles()}async close(){await this.K.close()}async putStyles(t){await this.K.setStyles(t)}async setSandboxAttributes(t){await this.K.setSandbox(t)}async setTitle(t){await this.K.setTitle(t)}}class Lt{constructor(t,e,s,i){this.g=t,this.T=e,this.X=s,this.R=i}async appendTo(t,e){const s=this.T.windowRef.document.querySelector(t);s||this.X.throw("SELECTOR_NOT_FOUND");const i=this.V(this.g.id,this.g.name,this.T.windowRef),n=new Promise((t=>i.onload=()=>t()));s.insertAdjacentElement(e,i),await n,this.g.element=i,this.g.windowRef=i.contentWindow,this.g.events$.next({source:this.g,type:it,data:void 0})}async clearStyles(){var t;null===(t=this.g.element)||void 0===t||t.removeAttribute("style")}async close(){const t=this.g.element;(null==t?void 0:t.parentNode)&&t.parentNode.removeChild(t)}async putStyles(t){for(const[e,s]of Object.entries(t))this.g.element.style[e]=s}async setSandboxAttributes(t){for(const e of t)this.g.element.sandbox.add(e)}async setTitle(t){this.g.element.title=t}V(t,e,s){const i=s.document.createElement("iframe");return i.src=`../${e}/index.html`,i.name=t,i.title="Rokt placement",i.style.display="block",i.style.width="100%",i.setAttribute("data-core-type","plugin"),i.setAttribute("data-e2e-id",this.R),i.sandbox.add("allow-scripts","allow-same-origin","allow-popups","allow-forms","allow-top-navigation","allow-popups-to-escape-sandbox"),i}}class Mt{constructor(t,e){this.K=e,this.events$=K(t.events$)(Y((t=>({eventName:t.type,data:t.data}))))}async send(t,e){await this.K.sendMessage(t,e)}on(t){return K(this.events$)(X((e=>e.eventName===t)),Y((t=>t.data)))}}class xt{constructor(t,e,s,i,n,r,o){this.W=t,this.G=e,this.tt=s,this.X=i,this.Y=n,this.et=r,this.B=o}async createRootPlugin(t,e,s,i){const n=await this.st(t,e,s),r=new Dt(n),o=this.nt(t),a=new Mt(t,n);return e.appendChild(t),new Ct(this.tt,this.G,t,e,i,this.W,this.Y,this,this.B,r,o,a)}async createChildHostPlugin(t,e,s,i,n){const r=await this.st(t,e,i),o=this.nt(t),a=new Dt(r);return e.appendChild(t),new Ct(this.tt,this.G,t,e,n,this.W,this.Y,this,this.B,a,o,s)}async createChildInternalPlugin(t,e,s,i,n){const r=this.nt(t),o=new Lt(t,e,r,i);return e.appendChild(t),new Ct(this.tt,this.G,t,e,n,this.W,this.Y,this,this.B,o,r,s)}nt(t){const e=new wt(q.Plugin,t.name);return t.unsubscribers.push(e.onError().subscribe((t=>this.X.reportError(t)))),e}async st(t,e,s){const{id:i,name:n}=t,r=this.et(t.events$,this.G);return await this.tt.createPlugin({id:i,name:n,e2eId:s,register:this.G===e,controllerRPCPlugin:r})}}class kt extends Map{async clear(){const t=[];for(const e of this.values())t.push(e.close());await Promise.all(t),super.clear()}}class Ut{constructor(t,e){this.rpcLocationService=e,this.it=t}get(t){return this.it.get(t)}async set(t,e=!1){e&&(t.domain=await this.getBaseDomain());const s=this.serialize(t);return this.it.set(s)}async getBaseDomain(){const t=await this.rpcLocationService.getHostname(),e=t.split("."),s=e.pop(),i=e.pop();return i&&s?`.${i}.${s}`:t}serialize(t){const{name:e,path:s="/",sameSite:i,secure:n,value:r,partitioned:o,domain:a}=t;let{expires:c}=t;if(!c){const t=new Date;t.setTime(t.getTime()+31536e6),c=t}let h=`${e}=${r};expires=${c.toUTCString()};path=${s}`;return a&&(h+=`;domain=${a}`),n&&(h+=";secure"),i&&(h+=`;samesite=${i}`),o&&(h+=";partitioned"),h}}const jt=Symbol.for("RemoteUi::Retain"),$t=Symbol.for("RemoteUi::Release"),Gt=Symbol.for("RemoteUi::RetainedBy");class Ft{constructor(){this.memoryManaged=new Set}add(t){this.memoryManaged.add(t),t[Gt].add(this),t[jt]()}release(){for(const t of this.memoryManaged)t[Gt].delete(this),t[$t]();this.memoryManaged.clear()}}function Wt(t){return Boolean(t&&t[jt]&&t[$t])}function Vt(t,e,s){const i=s.get(t);if(null!=i)return i;const n=Wt(t);if(n&&t[jt](),s.set(t,n),e){if(Array.isArray(t)){const i=t.reduce(((t,i)=>Vt(i,e,s)||t),n);return s.set(t,i),i}if(Bt(t)){const i=Object.keys(t).reduce(((i,n)=>Vt(t[n],e,s)||i),n);return s.set(t,i),i}}return s.set(t,n),n}function Bt(t){if(null==t||"object"!=typeof t)return!1;const e=Object.getPrototypeOf(t);return null==e||e===Object.prototype}function Ht(t,e){const s=t[e];if(void 0!==s&&"function"!=typeof s)throw new TypeError(`${e[0].toUpperCase()+e.slice(1)} must be a function or undefined`)}const Kt="_@f";function Xt(t){const e=new Map,s=new Map,i=new Map;return{encode:function i(n,r=new Map){if(null==n)return[n];const o=r.get(n);if(o)return o;if("object"==typeof n){if(Array.isArray(n)){r.set(n,[void 0]);const t=[],e=[n.map((e=>{const[s,n=[]]=i(e,r);return t.push(...n),s})),t];return r.set(n,e),e}if(Bt(n)){r.set(n,[void 0]);const t=[],e=[Object.keys(n).reduce(((e,s)=>{const[o,a=[]]=i(n[s],r);return t.push(...a),Object.assign(Object.assign({},e),{[s]:o})}),{}),t];return r.set(n,e),e}}if("function"==typeof n){if(e.has(n)){const t=e.get(n),s=[{[Kt]:t}];return r.set(n,s),s}const i=t.uuid();e.set(n,i),s.set(i,n);const o=[{[Kt]:i}];return r.set(n,o),o}const a=[n];return r.set(n,a),a},decode:n,async call(t,e){const i=new Ft,r=s.get(t);if(null==r)throw new Error("You attempted to call a function that was already released.");try{const t=Wt(r)?[i,...r[Gt]]:[i];return await r(...n(e,t))}finally{i.release()}},release(t){const i=s.get(t);i&&(s.delete(t),e.delete(i))},terminate(){e.clear(),s.clear(),i.clear()}};function n(e,s){if("object"==typeof e){if(null==e)return e;if(Array.isArray(e))return e.map((t=>n(t,s)));if(Kt in e){const n=e[Kt];if(i.has(n))return i.get(n);let r=0,o=!1;const a=()=>{r-=1,0===r&&(o=!0,i.delete(n),t.release(n))},c=()=>{r+=1},h=new Set(s),u=(...e)=>{if(o)throw new Error("You attempted to call a function that was already released.");if(!i.has(n))throw new Error("You attempted to call a function that was already revoked.");return t.call(n,e)};!function(t,e){if(!("Zone"in window))return Object.defineProperties(t,e);if(null===t||"object"!=typeof t&&"function"!=typeof t)throw new TypeError("Object.defineProperties called on non-object");if(!Object.isExtensible(t))throw new TypeError("Cannot define properties on a non-extensible object");[...Object.keys(e),...Object.getOwnPropertySymbols(e)].forEach((s=>{const i=e[s];if(!i||"object"!=typeof i)throw new TypeError("Property descriptor must be an object: "+i);if(Ht(i,"get"),Ht(i,"set"),("get"in i||"set"in i)&&("value"in i||"writable"in i))throw new TypeError("Invalid property descriptor. Cannot both specify accessors and a value or writable attribute");Object.defineProperty(t,s,i)}))}(u,{[$t]:{value:a,writable:!1},[jt]:{value:c,writable:!1},[Gt]:{value:h,writable:!1}});for(const t of h)t.add(u);return i.set(n,u),u}if(Bt(e))return Object.keys(e).reduce(((t,i)=>Object.assign(Object.assign({},t),{[i]:n(e[i],s)})),{})}return e}}function Yt(){return`${zt()}-${zt()}-${zt()}-${zt()}`}function zt(){return Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)}class qt{constructor(t,e,s,i,n,r){this.connection=t,this.G=e,this.rt=s,this.C=i,this.ot=n,this.ct=r}async createPlugin({name:t,config:e,e2eId:s}){const i=k(),n=Q(i,t),r=await this.C.createRootPlugin(n,this.G,null!=s?s:"",e);return this.ot.set(i,r),r}async getLauncherWindow(){if(!this.ht){const t=await this.rt.getWindow();!function(t,{deep:e=!0}={}){Vt(t,e,new Map)}(t),this.ht=function(t){return{cookies:new Ut(t.cookies,t.location),localStorageService:t.localStorage,sessionStorageService:t.sessionStorage,locationService:t.location}}(t)}return this.ht}async getElementBoundingRect(t){return await this.rt.getElementBoundingRect(t)}async getElementCoverage(t,e){return await this.rt.getElementCoverage(t,e)}async useExtension(t){throw new Error("to be implemented")}onError(){return this.ct.onError()}async terminate(){await this.ot.clear(),await this.rt.terminate()}}const Jt="CORE::PORT_EXCHANGE",Zt="CORE::READY",Qt="CORE::WAITING_FOR_PORT";var te;function ee(t){return Array.isArray(t)}!function(t){t[t.WAITING=0]="WAITING",t[t.CONNECTING=1]="CONNECTING",t[t.TRANSFERRING=2]="TRANSFERRING",t[t.CONNECTED=3]="CONNECTED",t[t.READY=4]="READY",t[t.FAILED_UNDEFINED_SOURCE=5]="FAILED_UNDEFINED_SOURCE"}(te||(te={}));class se{qualifier(t){return null!=t&&"object"==typeof t&&"$rpc"in t}handler(t){switch(t.$rpc){case"HtmlElement":return function(t){return document.querySelector(t.selector)}(t);case"PromiseProperty":return function(t){return t.getValue()}(t);case"Subscriber":return e=t,(...t)=>{const s=new F,i=e.getSubscriber(...t).then((t=>t.subscribe({next:t=>s.next(t),error:t=>s.error(t),complete:()=>s.complete()})));return{subscribe:(t,e,n)=>{const r=$(t,e,n),o=s.subscribe(r);return{unsubscribe:()=>{o.unsubscribe(),i.then((({unsubscribe:t})=>t()))}}}}};case"Listener":return function(t){return async(e,s)=>await t.setEventListener({eventName:e,callback:async(...t)=>await s(...t)})}(t)}var e}}async function ie({windowRef:t,createLauncherExtension:e=(()=>Promise.resolve(void 0)),pluginLibraryFactory:s=(t=>t),debug:i=!1}){const n=new wt(q.Controller),r=function(t,e){t.addEventListener("message",(function e(s){if(!r(s,Jt))return;n.status=te.TRANSFERRING;const o=s.ports[0];o.start(),i.resolve(o),t.removeEventListener("message",e),n.status=te.CONNECTED})),t.addEventListener("message",(function e(i){r(i,Zt)&&(t.removeEventListener("message",e),s.resolve(),n.status=te.READY)}));const s=new Et,i=new Et,n={postMessage:async(t,s)=>{try{(await i.promise).postMessage(t,s)}catch(i){e.throw(Z.POST_MESSAGE_CONNECTION_ERROR,[i,t,s].map((t=>JSON.stringify(t))).join("-"))}},addEventListener:async(t,e)=>{(await i.promise).addEventListener(t,e)},removeEventListener:async(t,e)=>{(await i.promise).removeEventListener(t,e)},terminate:async()=>{(await i.promise).close()},status:te.WAITING,ready:async()=>{t.parent.postMessage(Zt,"*")},onReady:()=>s.promise};return t.parent.postMessage(Qt,"*"),n;function r(e,s){return e&&"string"==typeof e.data&&e.data===s&&e.source===t.parent}}(t,n);try{const o=new B("host","host",W.Host),a=new kt,c=new It,h=function({qualifier:t,handler:e}){return function s(i){return n=i,Object(n)!==n?i:ee(i)?i.map((t=>s(t))):new Proxy(i,{get(i,n){const r=i[n];return t(r)?e(r):function(t){return null!==t&&"object"==typeof t&&!ee(t)}(r)?s(r):function(t){return"function"==typeof t}(r)?(...t)=>{const e=r(...t);return function(t){return t instanceof Promise}(e)?e.then((t=>s(t))):s(e)}:r}});var n}}(new se),u=function(t,{uuid:e=Yt,createEncoder:s=Xt,callable:i}={}){let n=!1,r=t;const o=new Map,a=new Map,c=function(t,e){let s;if(null==e){if("function"!=typeof Proxy)throw new Error("You must pass an array of callable methods in environments without Proxies.");const e=new Map;s=new Proxy({},{get(s,i){if(e.has(i))return e.get(i);const n=t(i);return e.set(i,n),n}})}else{s={};for(const i of e)Object.defineProperty(s,i,{value:t(i),writable:!1,configurable:!0,enumerable:!0})}return s}(d,i),h=s({uuid:e,release(t){u(3,[t])},call(t,s,i){const n=e(),r=w(n,i),[o,a]=h.encode(s);return u(5,[n,t,o],a),r}});return r.addEventListener("message",l),{call:c,replace(t){const e=r;r=t,e.removeEventListener("message",l),t.addEventListener("message",l)},expose(t){for(const e of Object.keys(t)){const s=t[e];"function"==typeof s?o.set(e,s):o.delete(e)}},callable(...t){if(null!=i)for(const e of t)Object.defineProperty(c,e,{value:d(e),writable:!1,configurable:!0,enumerable:!0})},terminate(){u(2,void 0),f(),r.terminate&&r.terminate()}};function u(t,e,s){n||r.postMessage(e?[t,e]:[t],s)}async function l(t){const{data:e}=t;var s;if(s=e,Array.isArray(s)&&"number"==typeof s[0]&&(null==s[1]||Array.isArray(s[1])))switch(e[0]){case 2:f();break;case 0:{const s=new Ft,[i,n,r]=e[1],a=o.get(n);try{if(null==a)throw new Error(`No '${n}' method is exposed on this endpoint`);const[t,e]=h.encode(await a(...h.decode(r,[s])));u(1,[i,void 0,t],e)}catch(t){const{name:e,message:s,stack:n}=t;throw u(1,[i,{name:e,message:s,stack:n}]),t}finally{s.release()}break}case 1:{const[t]=e[1];a.get(t)(...e[1]),a.delete(t);break}case 3:{const[t]=e[1];h.release(t);break}case 6:{const[t]=e[1];a.get(t)(...e[1]),a.delete(t);break}case 5:{const[t,s,i]=e[1];try{const e=await h.call(s,i),[n,r]=h.encode(e);u(6,[t,void 0,n],r)}catch(e){const{name:s,message:i,stack:n}=e;throw u(6,[t,{name:s,message:i,stack:n}]),e}break}}}function d(t){return(...s)=>{if(n)return Promise.reject(new Error("You attempted to call a function on a terminated web worker."));if("string"!=typeof t&&"number"!=typeof t)return Promise.reject(new Error(`Can’t call a symbol method on a remote endpoint: ${t.toString()}`));const i=e(),r=w(i),[o,a]=h.encode(s);return u(0,[i,t,o],a),r}}function w(t,e){return new Promise(((s,i)=>{a.set(t,((t,n,r)=>{if(null==n)s(r&&h.decode(r,e));else{const t=new Error;Object.assign(t,n),i(t)}}))}))}function f(){var t;n=!0,o.clear(),a.clear(),null===(t=h.terminate)||void 0===t||t.call(h),r.removeEventListener("message",l)}}(r),l=h(u.call),d=new xt(t,o,l,n,c,rt,s),w=function(t,e,s,i,n,r){return{async createPlugin(t,e,s){const r=k(),o=Q(r,t);return(await i.createRootPlugin(o,n,s,e)).id},async useExtension(e){const[,i]=await Tt(n,t,s,e,r);return i.getLauncherInterface()},async getLauncherExtension(...t){const s=e(...t);return s||r.throw(Z.LAUNCHER_EXTENSION_UNDEFINED),s},async reportError(t){r.reportError(t)},async onConnected(){}}}(t,e,c,d,o,n),f=new qt(r,o,l,d,a,n);return u.expose(w),r.ready(),i&&(t.CoreDebug={hostNode:o,extensionRegistry:c,CoreNode:B}),f}catch(t){throw t.message=`${t.message}; Connection status ${r.status}`,t}}const ne=()=>{},re=(t=ne,e=ne,s=ne)=>"function"!=typeof t?t:{next:t,error:e,complete:s};class oe{constructor(){this.St=[]}add(t){this.St.push(t)}unsubscribe(){this.St.forEach((t=>t.unsubscribe()))}}class ae{constructor(t){this._t=t}subscribe(t,e,s){const i=re(t,e,s);let n,r=!0;const o={next:t=>{r&&i.next(t)},complete:()=>{r&&(n&&n(),i.complete(),r=!1)},error:t=>{r&&(i.error(t),r=!1)}};n=this._t(o),r||n&&n();const a=new oe;return a.add({unsubscribe:()=>{n&&n(),r=!1}}),a}}class ce{constructor(t){this.value=t,this.complete=!1,this.skip=!1}}var he=function(t,e,s,i){return new(s||(s=Promise))((function(n,r){function o(t){try{c(i.next(t))}catch(t){r(t)}}function a(t){try{c(i.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(o,a)}c((i=i.apply(t,e||[])).next())}))};const ue=t=>(...e)=>new ae((s=>{const i=t.subscribe((t=>he(void 0,void 0,void 0,(function*(){try{let i=new ce(t);for(const t of e){const e=t(i);if(i=e.then?yield e:e,!0===i.skip||!0===i.complete)break}if(i.skip)return;s.next(i.value),!0===i.complete&&s.complete()}catch(t){s.error(t)}}))),(t=>s.error(t)),(()=>s.complete()));return()=>i.unsubscribe()})),le=t=>e=>(!1===t(e.value)&&(e.skip=!0),e),de=t=>e=>(t?!0===t(e.value)?e.complete=!0:e.skip=!0:e.complete=!0,e),we=t=>e=>{const s=t(e.value);return new ce(s)},fe={ROKT_START:"ROKT_START",PAGE_START:"PAGE_START",PLACEMENT_INTERACTIVE:"PLACEMENT_INTERACTIVE"},Ee="GET",me="POST";class pe{constructor(t){this.lt=t}get(t,e){return this.Tt({url:t,method:Ee,headers:e})}post({url:t,body:e={},headers:s,keepalive:i}){return this.Tt({url:t,method:me,body:e,headers:s,keepalive:i})}It(t){const e={};return t.forEach(((t,s)=>e[s.toLowerCase()]=t)),e}async Ot(t){let e;return e=(t.headers.get("Content-Type")||"").includes("json")?await t.json():await t.text(),e}bt(t){var e;const s=t.method||"GET";return!(t.headers&&t.headers["Content-Type"]||void 0)&&t.body&&"object"==typeof t.body&&(t.body=JSON.stringify(t.body),t.headers=Object.assign({"Content-Type":"application/json"},t.headers||{})),{url:t.url,options:{method:s,headers:t.headers,body:t.body,keepalive:null!==(e=t.keepalive)&&void 0!==e&&e}}}async Tt(t){const e=this.bt(t),s=await this.lt.fetch(e.url,e.options),i=this.It(s.headers);if(!s.ok)throw new l({additionalInformation:{responseCode:s.status,responseHeaders:JSON.stringify(i),responseStatusText:s.statusText,url:s.url}});return{body:await this.Ot(s),headers:i,status:s.status,statusText:s.statusText}}}class ye{constructor(t){this.Nt=t.navigator.globalPrivacyControl,this.Rt=t.navigator.userAgent}getGlobalPrivacyControl(){return this.Nt}getUserAgent(){return this.Rt}getApiUrl(t){return t?this.Pt("DEMO_ROKT_COM_URL"):this.Pt("ROKT_COM_URL")}getMultiPageSessionBlacklist(){return this.Pt("MULTI_PAGE_SESSION_BLACKLIST")}isNoDeviceIdPartner(t){return this.Pt("NO_DEVICE_ID_PARTNERS").replace(/\s/g,"").split(",").filter((t=>!!t)).includes(t)}getDebugMode(){return"true"===this.Pt("DEBUG").toLowerCase()}getControllerVersion(){return this.Pt("VERSION")}Pt(t){var e;return null!==(e={ROKT_COM_URL:"https://apps.rokt.com",DEMO_ROKT_COM_URL:"https://apps-demo.rokt.com",DOMAIN_TRANSFER:"",MULTI_PAGE_SESSION_BLACKLIST:"fcc19e4c9494452d9e8fde05ce5b0026,260,2554873377920922361,2745201443439123936,2745200842143701109,2745207580947400930,2745199502113902350,2745199845711287180,2745202495706113715,2745207061256356434,2745203934520160133,2745204291002445711,2745204909477737795,2745205253075122293,2745204600240091625,2768954163069212781,2806486756987564147,2806482466315226397,2806484768417702792,2806484390460579187,2806483595891628106,2856198770055723711,2856199491610230954,2856198078565987347,2745198819214101523,2901377256164439275,3002366673326196145,2856198770055723711,2806484768417702792,2856199491610230954,2806483595891628106,2768954163069212781,2806484390460579187,2806482466315226397,2806486756987564147,2856198078565987347,3012069034512628447,3056919513968942327,3060975702558142909",NO_DEVICE_ID_PARTNERS:"2215307220479662547,2222069010832063954,2388261640774383951,2393374215224752143,2545534615780864385,2695481750969397521,2695486883455316530",DEBUG:"false",VERSION:"1.5.9"}[t])&&void 0!==e?e:""}}class ve{constructor(t){this.At=t,this.Ct="",this.Dt="",this.Lt=!1,this.Mt=!1,this.xt=!1,this.kt=!1,this.Ut=new M}getAccountId(){return this.Ct}getTagId(){return this.Dt}setTagId(t){this.Dt=t}getNoFunctional(){return this.Lt}getNoTargeting(){return this.Mt}getDoNotShareOrSell(){return this.xt}getDoNotTrack(){return this.Lt&&this.Mt}isSandbox(){return this.kt}getRoktFirstTouch(){return void 0===this.jt&&this.At.then((t=>t.report(f(d.ROKT_FIRST_TOUCH_NOT_SET,{severity:u.WARNING})))),this.jt}getLimitedUse(){return this.Ut.promise}setAccountId(t){this.Ct=t}setNoFunctional(t){this.Lt=t}setNoTargeting(t){this.Mt=t}setDoNotShareOrSell(t){this.xt=t}setSandbox(t){this.kt=t}setRoktFirstTouch(t){this.jt=t}setLimitedUse(t){this.Ut.resolve(t)}}function ge(){return window.crypto||window.msCrypto}function Se(t){const e=Array.from(new Uint8Array(t)).map((t=>t.toString(16).padStart(2,"0"))).join("");return e}function _e(t){return new Promise(((e,s)=>{const i=function(t){if(window.TextEncoder)return(new TextEncoder).encode(t);const e=unescape(encodeURIComponent(t)),s=new Uint8Array(e.length);for(let t=0;t<e.length;t++)s[t]=e.charCodeAt(t);return s}(t),n=ge().subtle.digest("SHA-256",i);n.then?n.then((t=>{e(Se(t))}),s):(n.oncomplete=t=>{const s=t.target.result;e(Se(s))},n.onerror=t=>{s(t)})}))}function Te(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(t=>{return(("y"===t?8:0)^(e=new Uint8Array(1),ge().getRandomValues(e))[0]&15>>("y"===t?2:0)).toString(16);var e}))}class Ie{constructor(t,e,s){this.$t=t,this.Gt=e,this.Ft=s,this.Wt={},this.Vt=new M}getFirstPartyRecognisers(){return this.Wt}async getThirdPartyRecognisers(){const t=this.Ft.getEtag(),e=!t||this.$t.getNoTargeting()?{}:{etag:t},s=await this.Vt.promise;return Object.assign(Object.assign({},e),s)}setFirstPartyRecognisers(t,e){if(this.$t.getNoFunctional())this.Wt={};else{const s={cookie:e[Oe],localStorage:t[Oe]},i=this.Bt(s);this.Wt=i,this.Gt.set(i)}}initialiseRecognisers(){this.Ht()}setEtag(t){this.$t.getNoTargeting()||this.Ft.setEtag(t)}async Ht(){const t=this.Ft.get(),e=this.Bt(t);if(this.$t.getNoTargeting())this.Vt.resolve({});else{this.Vt.resolve(e);await this.$t.getLimitedUse()||this.Ft.set(e)}}Bt(t){var e,s;return{cookie:null!==(e=t.cookie)&&void 0!==e?e:Te(),localStorage:null!==(s=t.localStorage)&&void 0!==s?s:Te()}}}const Oe="RoktRecogniser",be="RoktEtag";class Ne{constructor(t,e){this.Kt=t,this.Xt=e}async get(){return{cookie:await this.Kt.then((t=>t.get(Oe))),localStorage:await this.Xt.then((t=>t.getItem(Oe)))}}async set(e){const{cookie:s,localStorage:i}=e;s&&await this.Kt.then((e=>{e.set({name:Oe,value:s,sameSite:t,secure:!0})})),i&&await this.Xt.then((t=>{t.setItem(Oe,i)}))}}class Re{constructor(t,e){this.Kt=t,this.Xt=e}get(){return{cookie:this.Kt.getCookie(Oe),localStorage:this.Xt.getItem(Oe)}}set(t){const{cookie:s,localStorage:i}=t;s&&this.Kt.setCookie({name:Oe,value:s,sameSite:e,secure:!0}),i&&this.Xt.setItem(Oe,i)}getEtag(){return this.Xt.getItem(be)}setEtag(t){this.Xt.setItem(be,t)}}new RegExp("^\\d{4}-\\d{2}-\\d{2}((T\\d{2}:\\d{2}(:\\d{2})?)(\\.\\d{1,6})?(Z|(\\+|-)\\d{2}:\\d{2})?)?$");class Pe{constructor(t,e,s,i,n){this.Yt=t,this.zt=e,this.qt=s,this.Jt=i,this.Zt=n,this.Qt="",this.te=!1,this.ee=50}initSession(t){if(t)return void this.setSessionId(t,{isTestSession:!1});const{sessionId:e,isTestSession:s}=this.se();if(e)return this.Qt=e,void(this.te=s);this.Qt="",this.te=!1}isTestSession(){return this.te}setSessionId(t,{isTestSession:e}={}){this.Qt=t,this.te=!0===e,this.ie(t),this.ne(this.Qt)}getSessionId(){return this.Qt&&this.ne(this.Qt),this.Qt}incrementSessionIdSelectionCount(){const t=this.zt.getAccountId(),e=this.Yt.getItem(this.re(t));if(!e)return;const s=this.Yt.getItem(`${e}-${t}`),i=(s?parseInt(s,10):0)+1;this.Yt.setItem(`${e}-${t}`,i.toString()),i===this.ee&&this.Jt.then((t=>{t.report(new l({message:"Session ID usage limit exceeded.",severity:u.WARNING,code:d.SESSION_LIMIT_EXCEEDED}))}))}noMultiPageSession(t=!1){const e=this.zt.getAccountId();return!!this.oe(this.qt.getMultiPageSessionBlacklist(),e)&&t}isSessionValid(){const t=this.zt.getAccountId(),e=this.zt.getNoFunctional(),{sessionId:s,timestamp:i}=this.se();if(e)return Boolean(this.Qt);const n=this.Yt.getItem(this.ae(s,t)),r=n?parseInt(n,10):0;return void 0!==s&&void 0!==i&&r<this.ee&&parseInt(i,10)>Date.now()-18e5}async ne(t){const e=this.zt.getAccountId(),s=Date.now().toString();this.Yt.setItem(this.ce(e),s),this.he(t,s)}oe(t,e){return t.split(",").filter(Boolean).includes(e)}async ie(t){const e=this.zt.getAccountId(),s=this.isTestSession();this.Yt.setItem(this.re(e),t),s&&this.Yt.setItem(this.ue(t),"true")}async he(t,e){var s;const{isTestSession:i}=this.se(),n=this.zt.getNoFunctional(),r=Number(e)+18e5;this.le=null!==(s=this.le)&&void 0!==s?s:this.oe(this.qt.getMultiPageSessionBlacklist(),this.zt.getAccountId()),!t||n||this.le||this.Zt.setSessionInformationCookie(`${t}|${i}|${r}`)}se(){var t;const e=this.zt.getAccountId();if(this.le=null!==(t=this.le)&&void 0!==t?t:this.oe(this.qt.getMultiPageSessionBlacklist(),e),this.le)return{sessionId:void 0,timestamp:void 0,isTestSession:!1};const s=this.Yt.getItem(this.re(e)),i=this.Yt.getItem(this.ce(e));if(s&&i){return{sessionId:s,timestamp:i,isTestSession:"true"===this.Yt.getItem(this.ue(s))}}const n=this.Zt.getSessionInformationCookie();if(n){const[t,e,s]=n.split("|");return{sessionId:t,timestamp:s,isTestSession:"true"===e}}return{sessionId:void 0,timestamp:void 0,isTestSession:!1}}re(t){return`rokt_session_id-${t}`}ue(t){return`${t}_is_test`}ce(t){return`rokt_session_timestamp-${t}`}ae(t,e){return`${t}-${e}`}}const Ae="/v1/events",Ce="/v1/experiences",De="/v2/metrics",Le="/v1/events/metrics",Me="/v1/info",xe="/v1/responses",ke="/v1/errors",Ue="/v1/log";const je="GET",$e="POST";const Ge="rokt-tag-id",Fe="rokt-session-id",We="rokt-account-id",Ve="rokt-page-id",Be="rokt-page-identifier",He="rokt-page-instance-guid",Ke="rokt-do-not-track",Xe="rokt-etag",Ye="rokt-first-party-cookie",ze="rokt-first-party-local-storage",qe="rokt-third-party-cookie",Je="rokt-third-party-local-storage",Ze="rokt-existing-test-session",Qe="rokt-layout-schema-version",ts="rokt-wsdk-version",es="SignalImpression",ss="SignalInitialize",is="SignalLoadStart",ns="SignalLoadComplete",rs="SignalGatedResponse",os="SignalResponse",as="CaptureAttributes",cs="SignalTimeOnSite",hs="__journey_complete__";class us{constructor({httpClient:t,sessionService:e,envConfig:s,partnerService:i,contextService:n,integrationConfigurationService:r}){this.qt=s,this.de=t,this.we=e,this.$t=i,this.fe=n,this.Ee=r}async get(t,e={},s){return this.Tt({method:je,url:t,headers:e,allowStaleSession:s})}async post(t){const{url:e,body:s,headers:i,keepalive:n,allowStaleSession:r}=t;return this.Tt({method:$e,url:e,body:s,headers:i,keepalive:n,allowStaleSession:r})}async Tt({method:t,url:e,body:s,headers:i={},keepalive:n,allowStaleSession:r}){const o=e===Ce,a=this.me(e),c=this.pe(i,o,!1!==r);if(t===je)return this.de.get(a,c);const h={url:a,headers:c,keepalive:n};return s&&(h.body=s),this.de.post(Object.assign(Object.assign({},h),{url:a}))}pe(t={},e,s){const i=[[We,this.$t.getAccountId()],[Be,this.fe.getPageIdentifier()],[ts,"v2"]],n=this.$t.getTagId(),r=this.we.noMultiPageSession(e),o=this.we.isSessionValid(),a=this.$t.getDoNotTrack();if(s||o||r){const t=this.we.getSessionId();if(t){i.push([Fe,t]);this.we.isTestSession()&&i.push([Ze,"true"])}}i.push([Ge,n]),i.push([Ke,a?"true":""]);const c=i.reduce(((t,[e,s])=>(s&&(t[e]=s),t)),{});return Object.assign(Object.assign(Object.assign({},c),t),this.Ee.getCustomHeaders())}me(t){return`${this.qt.getApiUrl(this.$t.isSandbox())}${t}`}}class ls extends Map{}const ds={[u.ERROR]:d.ERROR_LIMIT_EXCEEDED,[u.WARNING]:d.WARNING_LIMIT_EXCEEDED};class ws{constructor(t,e,s,i,n){this.ye=t,this.ve=e,this.Ee=s,this.fe=i,this.ge=n,this.Se={[u.ERROR]:10,[u.WARNING]:15},this._e={[u.ERROR]:0,[u.WARNING]:0},this.Te={[u.ERROR]:!1,[u.WARNING]:!1}}throw(t,e=!1){throw this.report(t,e),t}async report(t,e=!1){const s=t.integration||this.Ee.getIntegration();if(t.severity===u.INFO&&s===T)return;if(t.severity=t.severity||u.ERROR,!e&&this.Ie(t.severity))return void await this.Oe(t);const i=this.fe.getPartnerUrl(),n={additionalInformation:Object.assign(Object.assign({},t.additionalInformation),{message:t.message,version:`${this.Ee.getVersion()}-${this.ve.getControllerVersion()}`}),stackTrace:t.stack,severity:t.severity,reporter:t.reporter||"WSDK",integration:s,deviceInfo:this.ve.getUserAgent(),code:t.code||d.UNKNOWN_ERROR,url:i};t.severity!==u.INFO?await this.ye.post({url:ke,body:n}):await this.ge.log(n)}Ie(t){return this._e[t]+=1,this._e[t]>this.Se[t]}async Oe(t){this.Te[t.severity]||(t.code=ds[t.severity],this.Te[t.severity]=!0,await this.report(t,!0))}}const fs=0,Es=1,ms=2,ps="RTTI",ys="TTI",vs="integration",gs="framework",Ss="sessionRequest",_s="selection",Ts="selectionRequest",Is="pluginBootstrap",Os="pluginInteractive",bs="partnerUrlSet",Ns="recogniserInitDuration",Rs={PageStart:"0",IntegrationStart:"1",IntegrationEnd:"2",FrameworkStart:"3",FrameworkEnd:"4",SelectionStart:"5",SelectionEnd:"6",PluginBootstrapEnd:"7",PluginInteractive:"8",SessionRequestDuration:"9",SelectionRequestDuration:"10",RecogniserInitDuration:"12",PluginBootstrapStart:"13"};class Ps{constructor(t,e,s,i,n){this.be=t,this.ye=e,this.Jt=s,this.fe=i,this.Ee=n,this.Ne=new Map,this.Re=new Map,this.Pe=new Map}recordFrameworkTimestamp(t,e){this.Ae(t,fs,e)}recordPluginTimestamp(t,e,s){this.Ae(e,ms,s,t)}recordSelectionTimestamp(t,e,s){this.Ae(e,Es,s,t)}async reportStandardMetrics(t,e,s){let i=[];try{const n=this.Ce(t,e),r=this.De(n),o=this.Ee.getIntegration();i=Object.entries(r).map((([t,e])=>({metricName:t,value:e,integration:o,pluginAlias:s}))),await this.reportCustomMetrics(i)}catch(t){const e=this.Le(i),s=await this.Me(),n=f(t,{code:d.METRICS_REQUEST_FAILED,severity:u.WARNING,additionalInformation:{body:JSON.stringify(e),requestHeaders:JSON.stringify(s)}});this.Jt.report(n)}}async reportCustomMetrics(t){if(!t.length)return;const e=this.Le(t);this.xe(e);const s=e,i=await this.Me();await this.ye.post({url:De,body:s,headers:i})}Ae(t,e,s=Date.now(),i){e===fs?this.Ne.set(t,s):e===Es&&i?this.ke(i,t,s,this.Re):e===ms&&i&&this.ke(i,t,s,this.Pe)}async Me(){const t=await this.fe.getPageInstanceGuid(),e=await this.fe.getPageId();return{[He]:t,[Ve]:e}}Ce(t,e){const s=this.Pe.get(e),i=this.Re.get(t);return{frameworkEnd:this.Ne.get(Rs.FrameworkEnd),frameworkStart:this.Ne.get(Rs.FrameworkStart),integrationEnd:this.Ne.get(Rs.IntegrationEnd),integrationStart:this.Ne.get(Rs.IntegrationStart),pageStart:this.Ne.get(Rs.PageStart),pluginBootstrapStart:s.get(Rs.PluginBootstrapStart),pluginBootstrapEnd:s.get(Rs.PluginBootstrapEnd),pluginInteractive:s.get(Rs.PluginInteractive),recogniserInitDuration:this.Ne.get(Rs.RecogniserInitDuration),selectionEnd:i.get(Rs.SelectionEnd),selectionRequestDuration:i.get(Rs.SelectionRequestDuration),selectionStart:i.get(Rs.SelectionStart),sessionRequestDuration:this.Ne.get(Rs.SessionRequestDuration)}}De(t){const e={[vs]:Math.max(t.integrationEnd-t.integrationStart,1),[gs]:Math.max(t.frameworkEnd-t.frameworkStart,1),[_s]:t.selectionEnd-Math.max(t.selectionStart,t.frameworkEnd),[bs]:t.pluginBootstrapStart-t.selectionEnd,[Is]:t.pluginBootstrapEnd-t.pluginBootstrapStart,[Os]:Math.max(t.pluginInteractive-t.pluginBootstrapEnd,1),[Ts]:Math.round(t.selectionRequestDuration)};e[vs]&&e[gs]&&e[_s]&&e[Is]&&e[Os]&&(e[ps]=e[vs]+e[gs]+e[_s]+e[Is]+e[Os]);const s=t.integrationStart-t.pageStart>18e4,i=this.be.getLocationChangeTimeStamp(),n=s&&!i;if(t.pageStart&&e[ps]){const n=t.integrationStart-t.pageStart;s?i&&(e[ys]=i):e[ys]=Math.round(e[ps]+n)}if(!n&&(!e[ys]||e[ys]<0))throw new l({code:d.INVALID_METRICS,severity:u.WARNING,additionalInformation:{invalidEntries:Object.entries(t).reduce(((t,[e,s])=>`${t}${e}:${s};`),"")}});return t.sessionRequestDuration&&(e[Ss]=t.sessionRequestDuration),(t.recogniserInitDuration||0===t.recogniserInitDuration)&&(e[Ns]=Math.max(t.recogniserInitDuration,1)),e}Le(t){return t.map((t=>((t.value||0===t.value)&&(t.value=Math.round(t.value)),t)))}xe(t){const e=t.reduce(((t,e)=>!e.value||e.value<0?t.concat(`${e.metricName}:${e.value}`):t),[]);if(e.length)throw new l({code:d.INVALID_METRICS,severity:u.WARNING,additionalInformation:{invalidMetrics:e.join(",")}})}ke(t,e,s,i){const n=i.get(t)||new Map;n.set(e,s),i.set(t,n)}}class As extends ae{constructor(){super((t=>(this.Ue&&t.complete(),this.je.push(t),()=>this.je=this.je.filter((e=>e!==t))))),this.je=[],this.Ue=!1}next(t){for(const e of this.je)e.next(t)}error(t){for(const e of this.je)e.error(t)}complete(){this.Ue=!0;for(const t of this.je)t.complete()}asObservable(){return new ae((t=>{const e=this.subscribe(t);return()=>e.unsubscribe()}))}}class Cs extends As{constructor(t){super(),this.$e=t}subscribe(t,e,s){const i=re(t,e,s);return i.next(this.$e),super.subscribe(i)}next(t){return this.$e=t,super.next(t)}getValue(){return this.$e}}class Ds extends As{constructor(t=-1){super(),this.Ge=[],this.Fe=null,this.We=t}subscribe(t,e,s){const i=re(t,e,s);let n=!0;return this.Ge.filter((t=>(t===this.Fe&&(n=!1),n))).forEach((t=>i.next(t))),this.Fe&&i.error(this.Fe),i.error=t=>{this.Fe=t,e(t)},super.subscribe(i)}next(t){this.Fe||this.Ve(t),super.next(t)}error(t){this.Fe=t,this.Ve(t),super.error(t)}Ve(t){-1!==this.We&&this.Ge.length===this.We?(this.Ge.shift(),this.Ge.push(t)):this.Ge.push(t)}}const Ls="CompletedBeforeEmit",Ms=(t,e)=>{let s;const i="object"==typeof e;return new Promise(((n,r)=>{s=t.subscribe(n,r,(()=>{i?n(e.defaultValue):r(new Error(Ls))}))})).finally((()=>s.unsubscribe()))},xs=(...t)=>new ae((e=>{const s=new oe;let i=0;for(const n of t)s.add(n.subscribe((t=>e.next(t)),(t=>e.error(t)),(()=>{i+=1,i>=t.length&&e.complete()})));return()=>s.unsubscribe()}));const ks="DisplayPreset.FULLSCREEN",Us="DisplayPreset.EMBEDDED",js="DisplayPreset.ATTACHED",$s={[js]:{autoresize:!0,outerCss:{bottom:"0",left:"50%",maxWidth:"650px",overflow:"hidden",position:"fixed",transform:"translateX(-50%)",width:"100%"},innerCss:{width:"100%"}},[ks]:{autoresize:!1,applyHighestZIndex:!0,replaceTargetElement:"body",css:{height:"100%",left:"0",position:"fixed",top:"0",width:"100%"}},[Us]:{autoresize:!0,css:{minWidth:"100%",overflow:"hidden",width:"1px"}}},Gs={border:0,width:"1px",minWidth:"100%",boxSizing:"border-box",display:"block"};class Fs{constructor(t,e,s){this.Be=t,this.Jt=e,this.He=s,this.placementDisplay=new As,this.Ke=new M,this.Xe=t=>Object.assign({},$s[t])}get displayPreset(){return this.Ke.promise}async setDisplaySettings(t){try{let e=Object.assign({},t);e.preset&&(e=Object.assign(Object.assign({},e),this.Xe(e.preset))),this.Ke.resolve(e.preset),await this.Ye(e.sandbox),await this.ze(e),await this.qe(e.autoresize),await this.Je(e.title),!e.applyHighestZIndex||e.preset!==js&&e.preset!==ks||this.Be.display.setHighestZIndex(),e.preset===ks&&this.Be.display.setFullscreen(),this.placementDisplay.next(e),this.He.send(p)}catch(t){const e=f(t);this.Jt.report(e)}}async Ze(t){const e=this.Be.display.enableResizeDetection.bind(this.Be.display);t.iFrameResizer={resize:e}}async Ye(t){if(t)try{await this.Be.display.setSandboxAttributes(t)}catch(e){throw f(e,{code:y.SANDBOX_ATTRIBUTES,severity:u.ERROR,additionalInformation:{attributes:t}})}}async Je(t){if(t)try{await this.Be.display.setTitle(t)}catch(e){throw f(e,{code:y.SET_TITLE,severity:u.ERROR,additionalInformation:{title:t}})}}async qe(t=!1){try{const e=await this.Be.getPluginWindowRef();t&&e?(this.Ze(e),await this.Be.display.enableResizeDetection()):await this.Be.display.disableResizeDetection()}catch(e){throw f(e,{code:y.RESIZE_DETECTION,severity:u.ERROR,additionalInformation:{autoresize:t}})}}async ze(t){const{css:e,outerCss:s,innerCss:i}=t,n=Object.assign(Object.assign({},Gs),e);try{await this.Be.display.putStyles(this.Qe(n)),s&&await this.Be.display.putStyles(this.Qe(s)),i&&await this.Be.display.putStyles(this.Qe(i))}catch(t){throw f(t,{code:y.PUT_STYLES,severity:u.ERROR,additionalInformation:{css:n,outerCss:s,innerCss:i}})}}Qe(t){const e=/url|\\|&/i;return Object.entries(t).reduce(((t,[s,i])=>(e.test(i)||(t[s]=i),t)),{})}}class Ws{constructor(t){this.Be=t}async send(t,e){this.Be.parent&&await this.Be.parent.send(t,e)}onEvent(t){return this.Be.parent?this.Be.parent.on(t):new As}}class Vs{constructor(t,e,s,i){var n;this.Be=s,this.ts=i,this.runtimeInitTime=new Date,this.isInteractiveResolvable=new M,this.alias=this.Be.name,this.id=this.Be.id,this.placementId=e,this.parentId=null===(n=this.Be.parent)||void 0===n?void 0:n.id,this.cssSelector=this.Be.cssSelector,this.selectionId=t,this.config=new Ds(1),this.fonts=new Ds(1),this.configurables=new Ds(1),this.selectionContext=this.ts.selectionContext,this.loggingService=this.ts.loggingService,this.integrationConfigurationService=this.ts.integrationConfigurationService,this.partnerConfigService=this.ts.partnerConfigService,this.errorService=this.ts.errorService,this.contextService=this.ts.contextService,this.rdnEventService=this.ts.rdnEventService,this.es=this.ts.placementsRegister,this.ss=this.ts.metricsService,this.ns=this.ts.rdnMetricEventService,this.window=this.ts.window,this.Be.config$.subscribe(this.config),this.instanceGuid=Ms(ue(this.config)(le((t=>!!(null==t?void 0:t.instanceGuid))),we((t=>{var e;return null!==(e=null==t?void 0:t.instanceGuid)&&void 0!==e?e:""})))),this.parent=new Ws(this.Be),this.pluginCommunication=this.Be.pluginCommunication,this.controllerCommunication=this.Be.controllerCommunication,this.display=new Fs(s,this.ts.errorService,this.controllerCommunication),this.ss.recordPluginTimestamp(this.Be.id,Rs.PluginBootstrapStart);const r={onDisplayPreset:this.display.displayPreset};this.ts.placementMonitoringService.add(this.Be,r)}async pushMetric(t){if(this.ss.recordPluginTimestamp(this.Be.id,t.name,t.recordedTime),t.name===Rs.PluginInteractive){this.Be.parent||this.ss.reportStandardMetrics(this.selectionId,this.Be.id,this.Be.name);const e=await this.instanceGuid;this.ns.triggerPlacementMetricEvent({parentInstanceGuid:e,type:fe.PLACEMENT_INTERACTIVE,clientTimestamp:t.recordedTime})}}logMetric(t){this.ss.reportCustomMetrics([{metricName:t.name,value:t.recordedTime,pluginAlias:this.alias,integration:this.integrationConfigurationService.getIntegration()}])}async close(){await this.Be.close()}async ready(){await this.isInteractiveResolvable.promise}isChildPlugin(){return Promise.resolve(!!this.Be.parent)}onClose(){return this.Be.onClose()}createChildPlacement(t){const e=new Vs(this.selectionId,this.placementId,t,this.ts);return this.es.set(e.id,e),this.rs(this,e),e}async createChildPlugin(t,e){return await this.Be.createChild({name:t,config:e,e2eId:"rokt-placements-frame-"})}rs(t,e){const s=t.fonts.subscribe(e.fonts),i=t.configurables.subscribe(e.configurables);e.onClose().then((()=>{this.es.delete(e.id),s.unsubscribe(),i.unsubscribe()}))}}const Bs="OFFER_ENGAGEMENT",Hs="PLACEMENT_CLOSED",Ks="PLACEMENT_READY",Xs="PLACEMENT_RESIZE";var Ys,zs=Object.freeze({__proto__:null,CartEvent:{UPDATE_CART_ITEM_MESSAGE:"UPDATE_CART_ITEM_MESSAGE",UPSERT_ALERT:"UPSERT_ALERT",DELETE_ALERT:"DELETE_ALERT",UPSERT_DELIVERY_DETAILS:"UPSERT_DELIVERY_DETAILS"}}),qs=Object.freeze({__proto__:null,PartnerMessage:{UpdateCartItem:"V2_UPDATE_CART_ITEM"},PlacementMessage:{CartItemUpdated:"V2_CART_ITEM_UPDATED"}}),Js=(Object.freeze({__proto__:null,V1:zs,V2:qs}),Object.freeze({__proto__:null,Extension:{PartnerValidation:"PartnerValidation",ThankYouPageJourney:"ThankYouPageJourney"}})),Zs=Object.freeze({__proto__:null,PartnerValidationEvent:{SET_PARTNER_VALIDATION_STATUS:"SET_PARTNER_VALIDATION_STATUS",OPT_IN_TO_PARTNER_VALIDATION:"OPT_IN_TO_PARTNER_VALIDATION",SHOW_PARTNER_VALIDATION_STATUS:"SHOW_PARTNER_VALIDATION_STATUS"}});!function(t){t.PAYPAL="Paypal"}(Ys||(Ys={}));Object.freeze({__proto__:null,PaymentEvent:{PAYMENT_BUTTON_CLICKED:"PAYMENT_BUTTON_CLICKED"},get PaymentType(){return Ys}});var Qs=Object.freeze({__proto__:null,ThankYouPageStages:{Waiting:"Waiting",ThankYouPage:"ThankYouPage",ConfirmationPage:"ConfirmationPage"}});Object.freeze({__proto__:null,PartnerMessage:{SEND_UPSELLS:"SEND_UPSELLS"},PlacementMessage:{UPSELL_ENGAGEMENT:"UPSELL_ENGAGEMENT",UPSELLS_SENT:"UPSELLS_SENT"}});class ti{constructor(t,e,s){this.cs=new M,this.hs=new M,this.us=8e3,this.ls=[],this.ds=!0,this.ws=new Cs(!1),this.fs=ue(this.ws)(we(Boolean)),this.id=t,this.Es=e,this.context=e.selectionContext,this.ps=s,this.ys=e.attributesService,this.Jt=e.errorService}async close(){const t=this.getPlacements();this.cs.resolve();const e=await t;await Promise.all(e.map((t=>t.close())))}async getPlacements(){return this.hs.promise.catch((()=>[]))}noticeSubscriberEventAddedToEventPool(){this.ws.next(!0)}on(t){const e=new As;return Promise.resolve().then((()=>this.fs.subscribe((()=>{if(this.ls.length){const s=[],i=[];this.ls.forEach((e=>{e.eventName===t||"*"===t?s.push(e):i.push(e)})),s.forEach((t=>{e.next(t)})),this.ls=i}this.ds=!1,this.vs().then((s=>{ue(s)(le((e=>e.eventName===t||"*"===t))).subscribe((t=>{e.next(t)}))}),(t=>e.error(t)))})))),e.asObservable()}async place(){await this.gs(this.ps)}async ready(){const t=(await this.hs.promise).map((t=>t.isInteractiveResolvable.promise));await Promise.all(t)}async send(t,e){(await this.hs.promise).forEach((s=>s.pluginCommunication.send(t,e)))}async setAttributes(t){const e=as,s=await this.Es.sessionService.getSessionId(),i=await this.context.getPageInstanceGuid(),n=this.Ss(t);this.ys.update(s,t),this.Es.rdnEventService.triggerEvent({eventType:e,parentGuid:s,pageInstanceGuid:i,attributes:n},{},!0).then((()=>this.Es.launcherEventsService.emit(O))).catch((()=>this.Es.launcherEventsService.emit(b)))}Ss(t){const e=[];for(const[s,i]of Object.entries(t)){const t=this.ys.stringify(i);t&&e.push({name:s,value:t})}return e}async gs(t){try{const e=await Promise.race([t.then((t=>t.placements)),this.cs.promise.then((()=>[]))]),s=Promise.all(e.map((t=>this._s(t))));this.Ts(),this.hs.resolve(s)}catch(t){this.hs.reject(t)}}async _s(t){const{coreController:e,placementsRegister:s}=this.Es,i=t.name.replace("torrent","dcui"),n=await e.createPlugin({name:i,e2eId:`rokt-placements-frame-${t.id}`}),r=new Vs(this.id,t.id,n,this.Es);this.Is(r,t);const o=this.Os(null==t?void 0:t.targetElementRelation,null==t?void 0:t.targetElementPosition);return this.bs({corePlugin:n,placement:r,placementData:t,insertPosition:o}),s.set(r.id,r),r.onClose().then((()=>{r.controllerCommunication.send(Hs,{}),s.delete(r.id)})),r}Is(t,e){t.fonts.next(e.fonts),t.config.next(e.config),t.configurables.next(e.configurables)}async bs({placement:t,placementData:e,corePlugin:s,insertPosition:i}){try{await s.appendTo(e.targetElementSelector||"body",i),this.Ns(t)}catch(e){const s=await t.instanceGuid,i=f(e,{additionalInformation:{placementId:t.placementId,placementAlias:t.alias,placementInstanceGuid:s}});i.message===d.PLUGIN_ALREADY_APPENDED?this.Jt.report(Object.assign(Object.assign({},i),{code:d.PLUGIN_ALREADY_APPENDED})):this.Jt.report(Object.assign(Object.assign({},i),{code:d.SELECTOR_ELEMENT_NOT_FOUND,severity:u.WARNING}))}}async Ns(t){if(!await Promise.race([t.isInteractiveResolvable.promise.then((()=>!0)),x(this.us).then((()=>!1))])){const e=f({code:d.PLUGIN_INITIALIZATION_TIMEOUT,severity:u.ERROR,additionalInformation:{message:`Plugin frame failed to load within ${this.us}ms`}});this.Jt.report(e),t.isInteractiveResolvable.reject(new Error("Placement failed to load"))}}Os(t="child",e="append"){switch(`${t}-${e}`){case"sibling-prepend":return"beforebegin";case"child-prepend":return"afterbegin";case"sibling-append":return"afterend";default:return"beforeend"}}Ts(){if(!this.ds)return;this.vs().then((t=>ue(t)(le((t=>this.ds))).subscribe((t=>{this.ls.push(t),this.noticeSubscriberEventAddedToEventPool()})))).catch((()=>this.ds=!1))}vs(){return this.Rs||(this.Rs=this.hs.promise.then((t=>xs(...t.map((t=>ue(t.pluginCommunication.on("*"))(we((e=>Object.assign(Object.assign({},e),{placementId:t.id})))))))))),this.Rs}}class ei{constructor(){this.Ps=[],this.As=new As,this.Cs=()=>{this.Ds&&this.Ds.unsubscribe(),this.As.complete(),this.As=new As}}registerMiddleware(t){this.unregisterMiddleware(t),this.Ps.push(t)}unregisterMiddleware(t){const e=this.Ps.indexOf(t);e>=0&&this.Ps.splice(e,1)}updateSelectPlacementOptions(t){return this.Ps.reduce(((t,e)=>e.updateSelectPlacementOptions?e.updateSelectPlacementOptions(t):t),t)}splitSelectionData(t){const e=this.Ps.filter((t=>"splitSelectionData"in t&&"updateSelectionData"in t));return 0===e.length?((...t)=>new ae((e=>{for(const s of t)e.next(s)})))(t):(this.Cs(),this.Ds=xs(...e.map((e=>e.splitSelectionData(t)))).subscribe({next:t=>{this.As.next(t),e.forEach((e=>e.updateSelectionData(t)))},complete:this.Cs}),this.As.asObservable())}}var si=function(t,e,s){if(s||2===arguments.length)for(var i,n=0,r=e.length;n<r;n++)!i&&n in e||(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return t.concat(i||Array.prototype.slice.call(e))},ii=function(t,e,s){this.name=t,this.version=e,this.os=s,this.type="browser"},ni=function(t){this.version=t,this.type="node",this.name="node",this.os=process.platform},ri=function(t,e,s,i){this.name=t,this.version=e,this.os=s,this.bot=i,this.type="bot-device"},oi=function(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null},ai=function(){this.type="react-native",this.name="react-native",this.version=null,this.os=null},ci=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,hi=3,ui=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/]],li=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function di(t){return t?fi(t):"undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"===navigator.product?new ai:"undefined"!=typeof navigator?fi(navigator.userAgent):"undefined"!=typeof process&&process.version?new ni(process.version.slice(1)):null}function wi(t){return""!==t&&ui.reduce((function(e,s){var i=s[0],n=s[1];if(e)return e;var r=n.exec(t);return!!r&&[i,r]}),!1)}function fi(t){var e=wi(t);if(!e)return null;var s=e[0],i=e[1];if("searchbot"===s)return new oi;var n=i[1]&&i[1].split(".").join("_").split("_").slice(0,3);n?n.length<hi&&(n=si(si([],n,!0),function(t){for(var e=[],s=0;s<t;s++)e.push("0");return e}(hi-n.length),!0)):n=[];var r=n.join("."),o=function(t){for(var e=0,s=li.length;e<s;e++){var i=li[e],n=i[0];if(i[1].exec(t))return n}return null}(t),a=ci.exec(t);return a&&a[1]?new ri(s,r,o,a[1]):new ii(s,r,o)}function Ei(t){return di(t)}const mi="DesktopWeb",pi="MobileWeb";class yi{constructor(t,e,s,i){this.headers=t,this.status=e,this.statusText=s,this.url=i}}var vi=function(t,e,s,i){return new(s||(s=Promise))((function(n,r){function o(t){try{c(i.next(t))}catch(t){r(t)}}function a(t){try{c(i.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(o,a)}c((i=i.apply(t,e||[])).next())}))};function gi(t,e=3,s=100,i=(()=>!0)){return vi(this,void 0,void 0,(function*(){try{return yield t()}catch(t){if(e<=1||!i(t))throw t}return yield x(1*s),yield gi(t,e-1,s)}))}class Si{constructor(t="",e,s,i){this.Ls=t,this.Ms=e,this.xs=s,this.ks=i,this.Us=this.xs.then((()=>Date.now()),(()=>Date.now()))}getIdentifier(){return this.Ls}getLanguage(){return this.js("language")}getPageId(){return this.js("pageId")}getPageInstanceGuid(){return this.js("pageInstanceGuid")}getPageVariantName(){return this.js("pageVariantName")}getSelectionStartTime(){return this.ks}getSelectionEndTime(){return this.Us}getSessionId(){return this.js("sessionId")}getUrl(){return this.Ms}async js(t){return this.xs.then((e=>e.context[t])).catch((()=>""))}}class _i{constructor({environmentConfigService:t,errorService:e,launcherWindowService:s,metricsService:i,partnerConfigService:n,recogniserService:r,sessionService:o,selectionMiddlewareService:a,selectionContainerFactory:c,webApiService:h,performanceService:u,contextService:l,attributesService:d,referralService:w,launcherEventsService:f}){this.$s=new As,this.Gs=0,this.Fs=(t=!1,e)=>t?{}:{url:e},this.Ws=t,this.Jt=e,this.Vs=s,this.ss=i,this.Bs=n,this.Hs=r,this.we=o,this.Ks=a,this.Xs=c,this.ye=h,this.Ys=u,this.fe=l,this.ys=d,this.zs=w,this.qs=f}async selectPlacements(t){const e=++this.Gs,s=Date.now();t=this.Ks.updateSelectPlacementOptions(t);const i=Te();if(this.ss.recordSelectionTimestamp(i,Rs.SelectionStart,s),this.we.incrementSessionIdSelectionCount(),this.fe.setPageIdentifier(t.identifier||""),!t.url){const e=await this.Vs.getLocationService();t.url=await e.getHref(),this.Jt.report(new l({additionalInformation:{url:t.url},message:"URL fallback to async",severity:u.WARNING,code:"URL_FALLBACK_TO_ASYNC"}))}t.attributes=this.Js(t.attributes),this.ys.update(i,t.attributes);const n=this.Zs(t).then((t=>{if(e!==this.Gs)throw f({code:I,severity:u.WARNING,message:"Simultaneous selection response ignored."});this.Qs(t);const s=this.ti(t);return this.ei(i),this.qs.emit(O),this.qs.emit(N,s.context.pageId),this.qs.emit(R,s.context.pageInstanceGuid),this.qs.emit(P,s.context.pageVariantName),this.qs.emit(A,s.context.sessionId),s})).catch((t=>{this.qs.emit(b);const e=f(t,{code:d.EXPERIENCES_CALL_FAILED,severity:u.WARNING});this.Jt.throw(e)})),r=new Si(t.identifier,t.url,n,s),o=await this.Xs(r),a=new M;return this.si&&this.si.unsubscribe(),this.si=this.Ks.splitSelectionData(n).subscribe((t=>{const e=this.ii(i,o,t);a.isPending()&&a.resolve(e)})),a.promise}onSelection(){return this.$s.asObservable()}ii(t,e,s){const i=new ti(t,e,s);return i.place(),i.ready().catch((()=>{})),this.$s.next(i),i}async Zs(t){const e=this.ni(t),s=await this.ri();return gi((()=>this.ye.post({url:Ce,allowStaleSession:!1,body:e,headers:s}).then((t=>{var e,s;const i=(null===(e=null==t?void 0:t.headers)||void 0===e?void 0:e.Etag)||(null===(s=null==t?void 0:t.headers)||void 0===s?void 0:s.etag);return i&&this.Hs.setEtag(i),t}))),3,100,this.oi)}ni(t){const e={noFunctional:this.Bs.getNoFunctional(),noTargeting:this.Bs.getNoTargeting(),doNotShareOrSell:this.Bs.getDoNotShareOrSell(),gpcEnabled:this.Ws.getGlobalPrivacyControl()};if(t.omitUrl&&!t.identifier){const t=new l({message:"When omitUrl is specified a page identifier must be provided",severity:u.ERROR,code:d.PAGE_IDENTIFIER_DOES_NOT_EXIST});this.Jt.throw(t)}return Object.assign({attributes:t.attributes,pageIdentifier:t.identifier,privacyControl:e},this.Fs(t.omitUrl,t.url))}Js(t){const e=Object.assign({},t);if(t[g]||(e[g]=this.Ws.getUserAgent()),!t[S]){const t=function(t){const e=Ei(t),s=e?e.os:null;if(null!==s)switch(s){case"Amazon OS":case"Android OS":case"BlackBerry OS":case"iOS":case"Windows Mobile":return pi;default:return mi}}();t&&(e[S]=t)}const s=this.zs.getReferralId();return s&&(e[_]=s),this.ys.normalize(e)}async ri(){const t={[Qe]:"*"},e=Date.now(),[s,i]=await Promise.all([this.Hs.getFirstPartyRecognisers(),this.Hs.getThirdPartyRecognisers()]),n=Date.now();return this.ss.recordFrameworkTimestamp(Rs.RecogniserInitDuration,n-e),s.cookie&&(t[Ye]=s.cookie),s.localStorage&&(t[ze]=s.localStorage),i.cookie&&(t[qe]=i.cookie),i.localStorage&&(t[Je]=i.localStorage),i.etag&&(t[Xe]=i.etag),t}Qs(t){const e=t.body;if(!e.pageContext||!e.plugins&&!e.placements){const t=new l({message:"Invalid response"});(function(t){var e;return!!(null===(e=null==t?void 0:t.description)||void 0===e?void 0:e.match(/quota exceeded/i))})(e)&&(t.code="SANDBOX_EXCEEDED"),this.Jt.throw(t)}}ti(t){var e,s,i,n,r;const{body:o,headers:a}=t,c=null!==(e=a[We])&&void 0!==e?e:"",h=null!==(s=a[Fe])&&void 0!==s?s:"",u=null!==(i=a[Ze])&&void 0!==i?i:"";this.we.setSessionId(h,{isTestSession:"true"===u}),this.Bs.setAccountId(c),this.fe.setPageId(o.pageContext.pageId),this.fe.setLanguage(null!==(n=o.pageContext.language)&&void 0!==n?n:""),this.fe.setPageInstanceGuid(o.pageContext.pageInstanceGuid),this.Bs.setLimitedUse(!0===(null===(r=o.privacyControl)||void 0===r?void 0:r.limitedUse));const{language:l,pageId:d,pageInstanceGuid:w,pageVariantName:f=""}=o.pageContext;return{context:{language:l,pageId:d,pageInstanceGuid:w,pageVariantName:f,sessionId:h},placements:[...o.placements?o.placements:[],...o.plugins?o.plugins:[]].map((t=>this.ai(t)))}}ai(t){var e;const{fonts:s,plugin:i}=t;return{id:i.id,config:i.config,configurables:null!==(e=t.placementConfigurables)&&void 0!==e?e:{},fonts:null!=s?s:[],name:i.name,targetElementSelector:i.targetElementSelector||"body",targetElementRelation:i.targetElementRelation,targetElementPosition:i.targetElementPosition,targetSection:i.targetSection}}ei(t){const e=this.Ys.experiencesRequestPerformance();e&&this.ss.recordSelectionTimestamp(t,Rs.SelectionRequestDuration,e),this.ss.recordSelectionTimestamp(t,Rs.SelectionEnd)}oi(t){return!(t instanceof yi)||(!t.status||t.status<400||408===t.status)}}const Ti=(t,e=0,s={isImmediate:!1,useAnimationFrame:!1})=>{let i;const n=!0===s.useAnimationFrame&&"function"==typeof window.requestAnimationFrame;return function(...r){const o=s.isImmediate&&!i;var a;a=()=>{i=void 0,s.isImmediate||t(...r)},i=n?(i&&window.cancelAnimationFrame(i),window.requestAnimationFrame(a)):(i&&clearTimeout(i),setTimeout(a,e)),o&&t(...r)}};class Ii{constructor(t,e,s,i){this.ye=t,this.we=e,this.Jt=s,this.fe=i,this.ci=[],this.hi={},this.ui=((t,e=0,s={isImmediate:!1,useAnimationFrame:!1})=>{let i=new M;const n=Ti(((...e)=>{try{null==i||i.resolve(t(...e))}catch(t){null==i||i.reject(t)}i=new M}),e,s);return(...t)=>(n(...t),i.promise)})((()=>{const t=this.we.getSessionId(),e=this.ci.map((({eventData:e,options:s})=>this.li(e,s,t)));return this.ci=[],this.di(e)}),25)}async triggerEvent(t,e={},s=!1){try{await this.wi(t,e)}catch(t){if(s)throw t}}async wi(t,e={}){var s;const i=Object.assign(Object.assign({},e),{clientTimeStamp:null!==(s=e.clientTimeStamp)&&void 0!==s?s:new Date});if(this.fi(t))return;const n=this.Ei(t);t.eventType!==os&&t.eventType!==rs&&t.eventType!==cs?(this.ci.push({eventData:n,options:i}),await this.ui()):await this.mi(n,i)}mi(t,e){const s=this.we.getSessionId(),i=this.li(t,e,s);return this.di([i])}async di(t){const e=await this.Me();return this.ye.post({url:Ae,body:t,headers:e,keepalive:!0}).catch((async e=>{if(!(null==e?void 0:e.statusCode))try{return await this.ye.post({url:Me,body:t,keepalive:!0})}catch(e){if(!(null==e?void 0:e.statusCode))return this.ye.post({url:xe,body:t,keepalive:!0});throw e}throw e})).then((()=>{})).catch(this.pi.bind(this))}async Me(){const t=await this.fe.getPageId();return{[Ve]:t}}fi(t){return t.eventType===es&&(!!this.hi[t.parentGuid]||(this.hi[t.parentGuid]=!0,!1))}Ei(t){return Object.assign(Object.assign({},t),{instanceGuid:Te()})}pi(t){const e=f(t,{code:d.EVENT_RESPONSE,severity:u.WARNING});return this.Jt.report(e).catch((()=>{})),Promise.reject(t)}li(t,e,s){const i=t.attributes||[];return Object.assign(Object.assign({},t),{attributes:i,metadata:this.yi(e,t.metadata),sessionId:s})}yi(t,e=[]){const{clientTimeStamp:s=new Date,transformedTrafficURL:i}=t,n=[{name:"clientTimeStamp",value:s.toISOString()},{name:"captureMethod",value:"ClientProvided"}];return i&&n.push({name:"transformedTrafficURL",value:i}),[...n,...e]}}class Oi{constructor(t,e,s,i,n){this.ye=t,this.we=e,this.fe=s,this.ge=i,this.Jt=n,this.vi=[],this.gi=Ti((async()=>{var t;try{const t=this.vi;this.vi=[];const e=await this.Me();await this.ye.post({url:Le,headers:e,body:t})}catch(e){this.ge.log({additionalInformation:null!==(t=e.additionalInformation)&&void 0!==t?t:{},code:y.V1_METRIC_FAILURE})}}),25)}async triggerPageMetricEvent(t){const e=await this.fe.getPageInstanceGuid();this.Si(Object.assign(Object.assign({},t),{parentInstanceGuid:e}))}async triggerPlacementMetricEvent(t){this.Si(t)}Si(t){try{const e=new Date(t.clientTimestamp).toISOString(),s=this.we.getSessionId(),i=Te();this.vi.push({sessionId:s,parentInstanceGuid:t.parentInstanceGuid,instanceGuid:i,type:t.type,clientTimestamp:e}),this.gi()}catch(e){this.Jt.report(f(e,{code:"TEMP-ISO-DATE-ERROR",additionalInformation:{clientTimestamp:JSON.stringify(t.clientTimestamp),type:t.type}}))}}async Me(){const t=await this.fe.getPageId();return{[Ve]:t}}}class bi{constructor(t,e,s){this.coreController=e,this.selectionContext=s,this.contextService=t.contextService,this.sessionService=t.sessionService,this.errorService=t.errorService,this.metricsService=t.metricsService,this.placementsRegister=t.placementsRegister,this.rdnMetricEventService=t.rdnMetricEventService,this.loggingService=t.loggingService,this.partnerConfigService=t.partnerConfigService,this.attributesService=t.attributesService,this.integrationConfigurationService=t.integrationConfigurationService,this.launcherEventsService=t.launcherEventsService,this.window=t.window,this.placementMonitoringService=t.placementMonitoringService,this.webApiService=new us({httpClient:t.httpClient,sessionService:this.sessionService,envConfig:t.environmentConfigService,partnerService:t.partnerConfigService,contextService:this.contextService,integrationConfigurationService:this.integrationConfigurationService}),this.rdnEventService=new Ii(this.webApiService,this.sessionService,this.errorService,this.contextService)}}class Ni{constructor(t){this.lt=t}resourcePerformance(t){const e=this.lt.performance.getEntriesByType("resource").filter((e=>-1!==e.name.indexOf(t,e.name.length-t.length)));if(0===e.length)return;return e[e.length-1].duration}experiencesRequestPerformance(){return this.resourcePerformance(Ce)}}var Ri=function(t,e,s,i){return new(s||(s=Promise))((function(n,r){function o(t){try{c(i.next(t))}catch(t){r(t)}}function a(t){try{c(i.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(o,a)}c((i=i.apply(t,e||[])).next())}))};class Pi{constructor(t){this.Jt=t,this._i={}}update(t,e){const s=this.normalize(e);this._i[t]?this._i[t].next(Object.assign(Object.assign({},this._i[t].getValue()),s)):this.Ti(t,s)}onChange(t){return this._i[t]||this.Ti(t),this._i[t].asObservable()}normalize(t){const e={};for(const[s,i]of Object.entries(t)){const t=this.stringify(i);t&&(e[s]=t)}return e}stringify(t){return Array.isArray(t)?JSON.stringify(t.filter(((e,s)=>t.indexOf(e)===s&&this.Ii(e)))):this.Ii(t)?"object"==typeof t&&null!==t?JSON.stringify(t):String(t):""}async hash(t){const e={};try{const s=Object.entries(t).filter((([,t])=>null!=t&&""!==t)).map((async([t,s])=>{const i=`${t}sha256`,n=await(t=>Ri(void 0,void 0,void 0,(function*(){if("string"!=typeof t)throw new Error("Value to be hashed must be of type string");return _e(t.trim().toLocaleLowerCase())})))(String(s));e[i]=n}));return await Promise.all(s),e}catch(t){const e=f(t,{code:d.HASHING_FAILED,severity:u.WARNING});throw this.Jt.report(e),e}}Ti(t,e={}){this._i[t]=new Cs(e)}Ii(t){return null!=t&&""!==t}}class Ai{constructor(){this.Oi=new As}on(t){return ue(this.Oi)(le((({event:e})=>e===t||"*"===t)))}emit(t,e){this.Oi.next({event:t,body:e})}}class Ci{constructor(...t){this.bi=t}add(t,e={}){this.bi.forEach((s=>s.add(t,e)))}}function Di(t,e=500){const s=new M;let i;const n=t.display.onResizeDetection().subscribe((t=>{i&&clearTimeout(i),i=setTimeout((()=>{n.unsubscribe(),s.resolve(t)}),e)}));return t.onClose().then((()=>{s.resolve(),n.unsubscribe(),i&&clearTimeout(i)})),s.promise}class Li{constructor(t,e){this.Ni=t,this.Jt=e}add(t){this.Ri(t)}async Ri(t){const e=await Di(t,500);if(!e)return;const s=t.id,i=await this.Ni,n=await i.getElementBoundingRect(s);if(!n)return;const{height:r,width:o}=e,{height:a,width:c}=n;if(Math.abs(a-r)>1||c+1<o){const t=f({code:d.PLUGIN_MISSIZED,severity:u.INFO,additionalInformation:{expectedHeight:Math.floor(r).toString(),actualHeight:Math.floor(a).toString(),expectedWidth:Math.floor(o).toString(),actualWidth:Math.floor(c).toString()}});this.Jt.report(t)}}}class Mi{constructor(t,e){this.Ni=t,this.Jt=e}add(t,e){this.Pi(t,e)}async Pi(t,e){const{onDisplayPreset:s}=e,[i,n]=await Promise.all([Di(t),s]);if(!i||n!==Us)return;const r=t.id,o=await this.Ni,a=await o.getElementBoundingRect(r);if(!a)return;const{top:c,bottom:h,left:l,right:w,height:E,width:m}=a,p=Math.ceil(c+1),y=Math.ceil(l+1),v=Math.floor(w-1),g=Math.floor(h-1),S=Math.floor(c+E/2),_=Math.floor(l+m/4),T=Math.floor(l+m/2),I=[{x:y,y:p},{x:T,y:p},{x:v,y:p},{x:_,y:S},{x:T,y:S},{x:Math.floor(w-m/4),y:S},{x:y,y:g},{x:T,y:g},{x:v,y:g}],{points:O}=await o.getElementCoverage(r,{points:I});if(!(O.length&&Math.random()<.2))return;const b=JSON.stringify(O),N=f({code:O.length===I.length?d.PLUGIN_COVERED_FULL:d.PLUGIN_COVERED,severity:u.INFO,additionalInformation:{coveredPoints:b}});this.Jt.report(N)}}class xi{add(t){const e=t.display.onResizeDetection().subscribe((e=>t.controllerCommunication.send(Xs,e)));t.onClose().then((()=>e.unsubscribe()))}}const ki={HtmlElement:"HtmlElement",Subscriber:"Subscriber",Listener:"Listener",PromiseProperty:"PromiseProperty"};function Ui(t){return{$rpc:ki.HtmlElement,selector:t}}const ji=Symbol.for("RemoteUi::Retain"),$i=Symbol.for("RemoteUi::Release");Symbol.for("RemoteUi::RetainedBy");function Gi(t){return Boolean(t&&t[ji]&&t[$i])}function Fi(t,{deep:e=!0}={}){return Wi(t,e,new Map)}function Wi(t,e,s){const i=s.get(t);if(null!=i)return i;const n=Gi(t);if(n&&t[ji](),s.set(t,n),e){if(Array.isArray(t)){const i=t.reduce(((t,i)=>Wi(i,e,s)||t),n);return s.set(t,i),i}if(Hi(t)){const i=Object.keys(t).reduce(((i,n)=>Wi(t[n],e,s)||i),n);return s.set(t,i),i}}return s.set(t,n),n}function Vi(t,{deep:e=!0}={}){return Bi(t,e,new Map)}function Bi(t,e,s){const i=s.get(t);if(null!=i)return i;const n=Gi(t);if(n&&t[$i](),s.set(t,n),e){if(Array.isArray(t)){const i=t.reduce(((t,i)=>Bi(i,e,s)||t),n);return s.set(t,i),i}if(Hi(t)){const i=Object.keys(t).reduce(((i,n)=>Bi(t[n],e,s)||i),n);return s.set(t,i),i}}return n}function Hi(t){if(null==t||"object"!=typeof t)return!1;const e=Object.getPrototypeOf(t);return null==e||e===Object.prototype}function Ki(t){return{$rpc:ki.PromiseProperty,getValue:()=>t}}const Xi=t=>({$rpc:"Subscriber",getSubscriber:async(...e)=>({subscribe:(s,i,n)=>{const r=t(...e),o=re(s,i,n);Fi(o);const a=r.subscribe(o);return{unsubscribe:()=>{Vi(o),a.unsubscribe()}}}})});class Yi{constructor(){this.Ai={Ci:void 0,stages:{}},this.Di=!0,this.Li=new Cs(void 0)}init(t){this.Ai=t,this.Li.complete(),this.Di=!1,this.Li=new Cs(void 0),this.Mi(t.Ci)}cancel(){this.Di||(this.Ai={Ci:void 0,stages:{}},this.Mi(hs),this.Li=new Cs(void 0))}getCurrentStage(){return this.Li.getValue()}setNextStage(t){var e,s;const i=this.getCurrentStage();if(!i||this.Di)throw new l({code:y.JOURNEY_NOT_INITIALISED,severity:u.ERROR});const n=void 0!==t?t:null===(e=this.Ai.stages[i])||void 0===e?void 0:e.at(0);if(!n||!(null===(s=this.Ai.stages[i])||void 0===s?void 0:s.includes(n)))throw new l({message:`Journey can't progress from ${i} to ${n}`,code:y.INVALID_NEXT_JOURNEY_STAGE,severity:u.ERROR});this.Mi(n)}onChange(){return this.Li.asObservable()}Mi(t){t!==hs?this.Li.next(t):(this.Di=!0,this.Li.complete())}}const zi="ThankYou",qi="None",Ji={[Qs.ThankYouPageStages.ThankYouPage]:zi,[Qs.ThankYouPageStages.ConfirmationPage]:qi,[Qs.ThankYouPageStages.Waiting]:""};class Zi{constructor(){this.xi={},this.ki=new M,this.updateSelectionData=t=>{},this.splitSelectionData=t=>{if(!this.Ui){const e=new Promise(((e,s)=>{t.then((t=>{var s;this.ji=t.context,this.xi=t.placements.reduce(((t,e)=>{const s=e.targetSection||qi;return(t[s]||(t[s]=[])).push(e),t}),{}),e({context:t.context,placements:[]}),this.ki.resolve(!!(null===(s=this.xi.ThankYou)||void 0===s?void 0:s.length))})).catch(s)}));this.Ui=new Cs(e)}return this.Ui.asObservable()}}hasThankYouPageStage(){return this.ki.promise}nextSelectionData(t){const e=Ji[t];this.$i(this.xi[e]),this.xi[e]=[]}flush(){const t=Object.values(this.xi).flat();this.$i(t),this.complete()}complete(){var t;null===(t=this.Ui)||void 0===t||t.complete(),this.ki.isPending()&&this.ki.reject("Middleware forced to complete")}$i(t=[]){var e;const s=Promise.resolve({context:this.ji,placements:t});null===(e=this.Ui)||void 0===e||e.next(s)}}function Qi(t,...e){let s=ne;const i=Promise.race([...e,new Promise(((e,i)=>{s=e,setTimeout((()=>{i(`Timeout after ${t} milliseconds`)}),t)}))]);return Object.defineProperty(i,"cancel",{value:t=>{s(t)}}),i}class tn{constructor(t){this.Gi={},this.next=t=>{if(t!==Qs.ThankYouPageStages.ThankYouPage&&t!==Qs.ThankYouPageStages.ConfirmationPage)return;const e=this.Gi[t];if(!e)return this.Fi=Qi(500),void this.Fi.then(void 0,(()=>{this.Wi.flush()}));e().then((()=>{var e;null===(e=this.Wi)||void 0===e||e.nextSelectionData(t)}))},this.error=t=>{throw this.Wi.flush(),t},this.complete=()=>this.Wi.complete(),this.onStageChange=(t,e,s)=>{var i;this.Gi[t]||(this.Gi[t]=e,t===s&&(null===(i=this.Fi)||void 0===i||i.cancel(),this.next(t)))},this.Wi=t}}class en{constructor({errorService:t,selectionService:e,journeyManagerService:s,selectionMiddlewareService:i}){this.Vi=function(){const t=[];return{createListenerProxyMessage:e=>({$rpc:"Listener",setEventListener:async({eventName:s,callback:i})=>(Fi(i),t.push(i),await e(s,i))}),release:()=>t.forEach((t=>Vi(t)))}}(),this.Bi=async(t,e)=>{var s;return null===(s=this.Hi)||void 0===s?void 0:s.onStageChange(t,e,this.Ki.getCurrentStage())},this.Xi=()=>{var t;null===(t=this.Yi)||void 0===t||t.unsubscribe()},this.zi=t=>{var e;this.qi=t,null===(e=this.Yi)||void 0===e||e.unsubscribe(),this.Fi=Qi(2e3,t.ready()),this.Fi.then(void 0,this.Ji).catch(this.Ji),this.Yi=xs(t.on(Bs),t.on(Hs)).subscribe({next:this.Zi,complete:this.Xi,error:this.Ji})},this.Zi=()=>{var t;null===(t=this.Fi)||void 0===t||t.cancel(),this.Ki.setNextStage(),this.Xi()},this.Ji=t=>{const e=f({code:d.EXTENSION_SELECTION_ERROR,severity:u.ERROR,message:`ThankYouPage extension - ${t||"unknown error"}`});this.Jt.report(e),this.Zi()},this.Qi=e,this.Ki=s,this.Ks=i,this.Jt=t,this.tn=this.Qi.onSelection().subscribe({next:this.zi,complete:this.Xi})}terminate(){var t,e;this.Vi.release(),null===(t=this.tn)||void 0===t||t.unsubscribe(),this.Xi(),this.Ki.cancel(),null===(e=this.en)||void 0===e||e.unsubscribe(),this.Wi&&this.Ks.unregisterMiddleware(this.Wi)}async init(){if(this.Wi){this.terminate();const t=f({code:d.EXTENSION_INITIALIZATION,severity:u.WARNING,message:"ThankYouPage extension multiple attempts to init"});this.Jt.report(t)}return this.Wi=new Zi,this.Hi=new tn(this.Wi),this.Ki.init({Ci:Qs.ThankYouPageStages.Waiting,stages:{[Qs.ThankYouPageStages.Waiting]:[Qs.ThankYouPageStages.ThankYouPage,Qs.ThankYouPageStages.ConfirmationPage],[Qs.ThankYouPageStages.ThankYouPage]:[Qs.ThankYouPageStages.ConfirmationPage],[Qs.ThankYouPageStages.ConfirmationPage]:[hs]}}),this.en=this.Ki.onChange().subscribe(this.Hi),this.Ks.registerMiddleware(this.Wi),this.Wi.hasThankYouPageStage().then((t=>{t?this.Ki.setNextStage(Qs.ThankYouPageStages.ThankYouPage):this.Ki.setNextStage(Qs.ThankYouPageStages.ConfirmationPage)})),{changeToStage:async t=>this.Ki.setNextStage(t),onStageChange:this.Vi.createListenerProxyMessage(this.Bi),getCurrentSelection:()=>this.getCurrentSelection(),getNextSelection:()=>this.getNextSelection()}}getCurrentSelection(){return this.qi}getNextSelection(){return t=this.Qi.onSelection(),new Promise(((e,s)=>{const i=t.subscribe(((...t)=>{e(...t),i.unsubscribe()}),s,s)}));var t}}const sn=new Map,nn=(t,e)=>{sn.set(t,e)},rn=t=>sn.get(t),on=t=>{sn.delete(t)};function an(t,e){const s=new Promise((e=>{t.getPlacements().then((t=>{e(t.map((t=>function(t){const e=rn(t.id);if(e)return e;const s={id:t.placementId,element:Ui(t.cssSelector),close:async()=>{await t.close()},on:Xi((e=>ue(t.pluginCommunication.on(e))(we((t=>"*"===e?{event:t.eventName,body:t.data,placement:s}:{event:e,body:t,placement:s}))))),ready:async()=>{await t.ready()},send:async(e,s)=>t.pluginCommunication.send(e,s),onClose:async()=>t.onClose()};return nn(t.id,s),t.onClose().then((()=>{on(t.id)})),s}(t))))}))}));return{context:(i=t.context,{pageId:Ki(i.getPageId()),pageInstanceGuid:Ki(i.getPageInstanceGuid()),pageVariantName:Ki(i.getPageVariantName()),sessionId:Ki(i.getSessionId())}),close:async()=>(await t.getPlacements()).forEach((t=>t.close())),getPlacements:async()=>s,on:Xi((e=>ue(t.on(e))(we((({eventName:t,data:e,placementId:s})=>({event:t,body:e,placement:rn(s)})))))),async ready(){await t.ready()},send:async(e,s)=>(await t.ready(),t.send(e,s)),async setAttributes(e){try{await t.setAttributes(e)}catch(t){throw t}},unsubscribe(){e.report(f({code:y.METHOD_SELECTION_UNSUBSCRIBE,severity:u.INFO}))}};var i}var cn=function(t,e){var s={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(s[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(t);n<i.length;n++)e.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(t,i[n])&&(s[i[n]]=t[i[n]])}return s};function hn(t,e,s){const{attributesService:i,errorService:n,selectionService:r}=t,o=function(t){const{partnerValidationService:e}=t,s=e.getValidationStatus.bind(e),i=e.activatePartnerValidation.bind(e);let n={},r=[];const o=t=>(n[t]||(n[t]=new M),n[t]);return{use:e=>{const n=o(e);if(!n.isPending())return n.promise;if(e===Js.Extension.PartnerValidation){i();const t={getValidationStatus:s};return n.resolve(t),n.promise}if(e===Js.Extension.ThankYouPageJourney){const e=new en(t);return r.push(e),e.init().then((t=>{n.isPending()&&n.resolve(t)})).catch(n.reject),n.promise}throw new Error("Unknown extension name")},getExtension:async t=>o(t).promise,terminateExtensions:async()=>{Object.values(n).forEach((t=>{t.isPending()&&t.reject()})),n={},await Promise.all(r.map((t=>t.terminate()))),r=[]}}}(t),{terminateExtensions:a}=o,c=cn(o,["terminateExtensions"]);return Object.assign({get version(){return s},async captureConversion(t){const e=await r.selectPlacements(t),s=await e.getPlacements();s&&s.length>0&&n.report(f({code:d.SELECTION_MADE_FOR_CONVERSION,severity:u.WARNING}))},hashAttributes:async t=>i.hash(t),selectPlacements:async t=>an(await r.selectPlacements(Object.assign({},t)),n),async terminate(){try{a();(await e).terminate()}catch(t){const e=f(t,{code:d.TERMINATE_FAILED,severity:u.ERROR});n.report(e)}}},c)}function un(t,e){return async function(s){const{environmentConfigService:i,integrationConfigurationService:n,loggingService:r,metricsService:o,partnerConfigService:a,rdnMetricEventService:c,recogniserService:h,referralService:u,selectionService:l,sessionCookieService:w,sessionService:E}=t,{customHeaders:m,doNotShareOrSell:p,frameworkStart:y,integration:v,integrationEnd:g,noDeviceId:S,noFunctional:_,noTargeting:T,pageStart:I,sandbox:O,sessionId:b,version:N}=s;O&&t.window.console.warn("ROKT: 'sandbox' mode enabled. ROKT Placements shown will not generate revenue. If this is not intended then please omit the 'sandbox' flag when initializing ROKT's SDK.");const R=String(s.accountId),P=s.integrationStart,A=R.indexOf("_")>=0?R.substring(0,R.indexOf("_")):R;a.setTagId(R),a.setAccountId(A),a.setRoktFirstTouch(P),n.setIntegration(v||""),n.setVersion(null!=N?N:""),a.setDoNotShareOrSell(!0===p);const C=i.isNoDeviceIdPartner(A),D=S||C;a.setNoFunctional(D||!0===_),a.setNoTargeting(D||!0===T),a.setSandbox(!0===O);const{roktCookies:L,roktLocalStorage:M}=s;n.setCustomHeaders(m||{}),h.setFirstPartyRecognisers(null!=M?M:{},null!=L?L:{}),h.initialiseRecognisers(),w.initialiseSessionInformationCookie(null!=L?L:{}),u.setReferralId(null!=M?M:{},null!=L?L:{}),E.initSession(b),o.recordFrameworkTimestamp(Rs.IntegrationStart,P),o.recordFrameworkTimestamp(Rs.IntegrationEnd,g),o.recordFrameworkTimestamp(Rs.FrameworkStart,y),o.recordFrameworkTimestamp(Rs.PageStart,I),c.triggerPageMetricEvent({type:fe.ROKT_START,clientTimestamp:P}),c.triggerPageMetricEvent({type:fe.PAGE_START,clientTimestamp:I});const x=function({errorService:t,loggingService:e,metricsService:s,launcherEventsService:i}){return{async raiseError(e){const s=f(e);await t.report(s)},on:Xi((t=>ue(i.on(t))(we((t=>({event:t.event,body:t.body})))))),async log(t){await e.log(t)},async changePage(t){const e=(null==t?void 0:t.pageInitTimestamp)||Date.now();s.recordFrameworkTimestamp(Rs.PageStart,e),s.recordFrameworkTimestamp(Rs.IntegrationStart,e)}}}(t),k=hn(t,e,N);return o.recordFrameworkTimestamp(Rs.FrameworkEnd,Date.now()),Math.random()<.2&&ue(l.onSelection())(de()).subscribe((async t=>{try{await t.ready(),await r.log({code:d.LAUNCHER_VERSION})}catch(t){}})),{public:k,private:x}}}class ln{constructor(t,e){this.Ni=t,this.sn=new M,this.Ni.then((async t=>{try{const e=await t.getLauncherWindow();this.sn.resolve(e)}catch(t){const s=await e,i=f(t,{code:"LAUNCHER_WINDOW_SERVICE_ERROR"});s.report(i),this.sn.reject(i)}}))}async getCookiesService(){return this.sn.promise.then((t=>t.cookies))}async getLocalStorageService(){return this.sn.promise.then((t=>t.localStorageService))}async getSessionStorageService(){return this.sn.promise.then((t=>t.sessionStorageService))}async getLocationService(){return this.sn.promise.then((t=>t.locationService))}}function dn(t){const e=wn(t.message,t.name,d.UNKNOWN_ERROR,u.ERROR,t.stack);(0,v.reportError)(e)}const wn=(t,e,s,i,n)=>Object.assign({message:t,name:e,code:s,severity:i,tagId:""},n&&{additionalInformation:{stack:n}});class fn{constructor(){this.nn=new M,this.rn=new M,this.an="",this.cn="",this.hn=Te(),this.un=""}getLanguage(){return this.an}getLauncherInstanceId(){return this.hn}async getPageInstanceGuid(){return this.nn.promise}async getPageId(){return this.rn.promise}getPageIdentifier(){return this.cn}getPartnerUrl(){return this.un}setLanguage(t){this.an=t}setPageInstanceGuid(t){this.nn.isFulfilled()&&(this.nn=new M),this.nn.resolve(t)}setPageId(t){this.rn.isFulfilled()&&(this.rn=new M),this.rn.resolve(t)}setPageIdentifier(t){this.cn=t}setPartnerUrl(t){this.un=t}}class En{constructor(){this.ln={},this.dn="",this.wn=""}getCustomHeaders(){return this.ln}getIntegration(){return this.dn}getVersion(){return this.wn}setCustomHeaders(t){this.ln=t}setIntegration(t){this.dn=t}setVersion(t){this.wn=t}}class mn{constructor(t){this.fn=t,this.En="",this.mn=null,this.pn()}getLocationChangeTimeStamp(){return this.mn?Date.now()-this.mn:null}cleanup(){clearInterval(this.yn),this.yn=void 0}async pn(){try{const t=await this.fn;this.En=await t.getHref();const e=async()=>{try{const e=await t.getHref();if(e===this.En)return;this.En=e,this.mn=Date.now()}catch(t){this.cleanup()}};this.yn=setInterval(e,500)}catch(t){this.cleanup()}}}class pn{constructor(t,e){this.configurables=t.asObservable(),this.fonts=e.asObservable()}}class yn{constructor(t){this.vn=t,this.settings=t.display.placementDisplay,this.setDisplaySettings=this.setDisplaySettings.bind(this)}async setDisplaySettings(t){this.vn.display.setDisplaySettings(t),this.vn.isInteractiveResolvable.resolve(),setTimeout((()=>{this.vn.controllerCommunication.send(Ks,{})}),20)}}class vn{constructor(t){this.vn=t,this.getFrameStart=async()=>new Date(this.vn.window.performance.timing.navigationStart)}async notifyInteractive(){if(void 0===this.vn.parentId){const t=Date.now();this.vn.pushMetric({origin:ms,name:Rs.PluginInteractive,recordedTime:t})}}async log(t,e){this.vn.logMetric({origin:ms,name:t,recordedTime:e})}}class gn{constructor(t,e){this.gn=t,this.fe=e,this.fe.getPageInstanceGuid().then((t=>{this.Sn=t}))}async issueSignal(t,e,s={}){const{overrideTimestamp:i,transformedTrafficURL:n}=s,r={clientTimeStamp:i?new Date(i.toISOString()):void 0,transformedTrafficURL:n},o=this._n(t,e,s),a=await this.fe.getPageInstanceGuid();a&&(o.pageInstanceGuid=a),this.gn.triggerEvent(o,r)}async issueSignalSync(t,e,s={}){const{overrideTimestamp:i,transformedTrafficURL:n}=s,r={clientTimeStamp:i?new Date(i.toISOString()):void 0,transformedTrafficURL:n},o=this._n(t,e,s);this.Sn&&(o.pageInstanceGuid=this.Sn),this.gn.triggerEvent(o,r)}_n(t,e,s){const{instanceGuid:i,attributes:n,metadata:r,objectData:o}=s;return{eventType:t,parentGuid:e,instanceGuid:i,attributes:n,metadata:r,objectData:o}}}var Sn=function(t,e){var s={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(s[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(t);n<i.length;n++)e.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(t,i[n])&&(s[i[n]]=t[i[n]])}return s};class _n{constructor(t,e){this.Jt=t,this.Ee=e}async raise(t){const{additionalInformation:e,message:s,level:i}=t,n=Sn(t,["additionalInformation","message","level"]);this.Jt.report(Object.assign(Object.assign({name:"PluginError",reporter:"PLUGIN",integration:this.Ee.getIntegration(),message:s||"Plugin error raised.",severity:i},n),{additionalInformation:e}))}}class Tn{constructor(t){this.vn=t}async send(t,e){this.vn.controllerCommunication.send(t,e)}onEvent(t){return this.vn.controllerCommunication.on(t)}}class In{constructor(t,e,s,i){this.vn=t,this.we=e,this.fe=s,this.Tn=i}getRuntimeInitTime(){return Promise.resolve(this.vn.runtimeInitTime)}getRoktAccountId(){return Promise.resolve(this.vn.partnerConfigService.getAccountId())}getParentInstanceId(){return Promise.resolve(this.vn.parentId)}getRoktPageInstanceGuid(){return this.vn.contextService.getPageInstanceGuid()}getAlias(){return Promise.resolve(this.vn.alias)}getLauncherInstanceId(){return Promise.resolve(this.fe.getLauncherInstanceId())}getPluginInstanceId(){return Promise.resolve(this.vn.id)}getRoktTagId(){return Promise.resolve(this.vn.partnerConfigService.getTagId())}getRoktSessionId(){return Promise.resolve(this.we.getSessionId())}getLanguage(){return Promise.resolve(this.fe.getLanguage())}isSandboxed(){return Promise.resolve(this.vn.partnerConfigService.isSandbox())}isChildPlugin(){return this.vn.isChildPlugin()}isPlugin(){return Promise.resolve(!0)}close(){return Promise.resolve(this.vn.close.call(this.vn))}addAdvertiserWindowRef(t,e){this.Tn.addActivePage(t,e)}}class On{constructor(t){this.In=t,t.then((t=>{t.appendToHostSelector("body")}))}async close(){const t=await this.In;await t.close()}async onClose(){const t=await this.In;await t.onClose()}async putConfig(t){const e=await this.In;await e.putConfig(t)}async send(t,e){const s=await this.In;await s.send(t,e)}onEvent(t){const e=new As;return this.In.then((s=>{s.on(t).subscribe((t=>{e.next(t)}))})),e.asObservable()}}class bn{constructor(t){this.vn=t}create(t){const{url:e,name:s,config:i}=t;let n=s;e&&!s&&(n=(t=>{try{return t.split("/plugins/")[1].split("/")[0]}catch(e){return"[no-alias]"+t}})(e),this.On(e));const r=this.vn.createChildPlugin(n,i);return new On(r)}On(t){this.vn.loggingService.log({code:y.URL_CHILD_PLUGIN_CREATED,additionalInformation:{url:t}})}}class Nn{constructor(t){this.vn=t}async send(t,e){this.vn.parent.send(t,e)}onEvent(t){return this.vn.parent.onEvent(t)}}class Rn{constructor(t,e,s,i,n){if(void 0===t.parentId){const e=Date.now();t.pushMetric({origin:ms,name:Rs.PluginBootstrapEnd,recordedTime:e})}this.config=ue(t.config)(we((t=>t))),this.display=new yn(t),this.context=new In(t,e,s,n),this.childPlugin=new bn(t),this.parentInteraction=new Nn(t),this.partnerInteraction=new Tn(t),this.rdn=new gn(t.rdnEventService,t.contextService),this.metrics=new vn(t),this.error=new _n(t.errorService,t.integrationConfigurationService),this.theme=new pn(t.configurables,t.fonts),this.attributes=i.onChange(t.selectionId)}}class Pn{constructor(t,e,s){this.ye=t,this.Ee=e,this.ve=s}async log(t){var e,s;const i=null!==(e=t.integration)&&void 0!==e?e:this.Ee.getIntegration();if(i===T)return;const n=Object.assign(Object.assign({severity:u.INFO},t),{additionalInformation:Object.assign(Object.assign({},t.additionalInformation),{version:`${this.Ee.getVersion()}-${this.ve.getControllerVersion()}`}),deviceInfo:this.ve.getUserAgent(),integration:i,reporter:null!==(s=t.reporter)&&void 0!==s?s:"WSDK"});await this.ye.post({url:Ue,body:n,keepalive:!0})}}class An{constructor(t){this.Qi=t,this.bn={}}activatePartnerValidation(){this.Qi.onSelection().subscribe(this.Nn.bind(this))}async getValidationStatus(){var t;const e=((...t)=>new ae((e=>{if(!t.length)return e.complete(),ne;const s=new oe,i=new Array(t.length),n=new Array(t.length),r=t=>!i.includes(void 0)&&e.next(t);for(let e=0;e<t.length;e++){const o=t[e].subscribe((t=>{n[e]=t,i[e]=!0,r(n)}));s.add(o)}return()=>s.unsubscribe()})))(...Object.values(this.bn)),s=await Ms(e,{defaultValue:[]}),i={isValid:!0,placements:[]};for(const e of s)e.optedIn&&e.placement&&(null===(t=e.errors)||void 0===t?void 0:t.length)&&(i.isValid=!1,i.placements.push({element:Ui(e.placement.cssSelector),errors:e.errors}),e.placement.pluginCommunication.send(Zs.PartnerValidationEvent.SHOW_PARTNER_VALIDATION_STATUS));return i}async Nn(t){(await t.getPlacements()).forEach((t=>{const e=new Ds(1),s=this.Rn(t).subscribe(e);this.bn[t.id]=e,t.onClose().then((()=>{delete this.bn[t.id],s.unsubscribe()}))}))}Rn(t){return new ae((e=>{const s=ue(xs(ue(t.pluginCommunication.on(Zs.PartnerValidationEvent.OPT_IN_TO_PARTNER_VALIDATION))(we((()=>!0))),ue(t.pluginCommunication.on(p))(we((()=>!1)))))(de()),i=ue(s)(le((t=>!t)),we((()=>({errors:[],placement:t,optedIn:!1})))),n=ue(t.pluginCommunication.on(Zs.PartnerValidationEvent.SET_PARTNER_VALIDATION_STATUS))(we((e=>({errors:e.errors,placement:t,optedIn:!0})))),r=xs(i,n).subscribe(e);return t.onClose().then((()=>{e.next({placement:null,errors:[],optedIn:!1}),e.complete()})),()=>r.unsubscribe()}))}}class Cn{setReferralId(t,e){const[s,i]=[E,m].map((e=>t[e])),n=e[m];this.Pn=s||i||n||void 0}getReferralId(){return this.Pn}}const Dn="RoktSessionId";class Ln{constructor(t,e,s){this.Kt=t,this.zt=e,this.qs=s,this.An=""}async setSessionInformationCookie(t){this.qs.emit(C,t);const e=this.Cn(t),s=await this.Kt,n=this.zt.getAccountId();this.Dn(e)&&s.set({name:`${Dn}-${n}`,sameSite:i,secure:!0,value:t,expires:new Date(e.expirationTimestamp)},!0)}getSessionInformationCookie(){return this.An}initialiseSessionInformationCookie(t){const e=this.zt.getTagId(),s=t[`${Dn}-${e}`];s&&this.Dn(this.Cn(s))&&(this.An=s)}Cn(t){const[e,s,i]=t.split("|");return{sessionId:e,isTestSession:"true"===s,expirationTimestamp:Number(i)}}Dn(t){return""!==t.sessionId&&!!t.expirationTimestamp}}class Mn{constructor(t,e,s){this.gn=t,this.Bs=e,this.Qi=s;const i=this.Qi.onSelection();ue(i)(de()).subscribe((t=>this.Ln(t))),i.subscribe((t=>this.Nn(t)))}async Ln(t){const e=await t.context.getPageInstanceGuid(),s=this.Bs.getRoktFirstTouch();if(!s)return;const i=new Date(s);this.Mn(ss,e,i)}async Nn(t){if(!(await t.getPlacements()).length)return;const e=await t.context.getPageInstanceGuid();this.Mn(is,e,new Date(t.context.getSelectionStartTime())),this.Mn(ns,e,new Date(await t.context.getSelectionEndTime()))}Mn(t,e,s){e&&this.gn.triggerEvent({eventType:t,parentGuid:e},{clientTimeStamp:s})}}const xn=24e4;var kn;!function(t){t.timeout="timeout",t.advertiserPageClosed="advertiserPageClosed",t.partnerPageClosed="partnerPageClosed"}(kn||(kn={}));class Un{constructor(t){this.gn=t,this.xn=new Map,this.kn=void 0}addActivePage(t,e){if(t){const s=Date.now();this.xn.has(e)||this.xn.set(e,{windowRef:t,startTime:s}),this.kn||this.Un()}else this.jn(e,void 0,void 0,!1)}$n(t){this.xn.delete(t),0===this.xn.size&&(clearInterval(this.kn),this.kn=void 0,window.removeEventListener("beforeunload",this.Gn.bind(this)))}jn(t,e,s,i){this.gn.triggerEvent({eventType:cs,parentGuid:t,objectData:{durationMs:void 0===s?"":String(s),trigger:void 0===e?"":e,isSupported:String(i)}})}Gn(){this.xn.forEach(((t,e)=>{const s=Math.min(Date.now()-t.startTime,xn);this.jn(e,kn.partnerPageClosed,s,!0),this.$n(e)}))}Un(){window.addEventListener("beforeunload",this.Gn.bind(this)),this.kn=setInterval((()=>{this.xn.forEach(((t,e)=>{const{windowRef:s,startTime:i}=t,n=Date.now()-i;if(s.closed){const t=Math.min(n,xn);this.jn(e,kn.advertiserPageClosed,t,!0),this.$n(e)}else n>xn&&(this.jn(e,kn.timeout,xn,!0),this.$n(e))}))}),100)}}class jn{constructor(t){this.window=o(),this.errorServicePromise=new M,this.localStorageService=new c(this.window),this.sessionStorageService=new h(this.window),this.cookieService=new n(this.window),this.thirdPartyRecogniserAccessor=new Re(this.cookieService,this.localStorageService),this.contextService=new fn,this.partnerConfigService=new ve(this.errorServicePromise.promise),this.environmentConfigService=new ye(this.window),this.integrationConfigurationService=new En,this.performanceService=new Ni(this.window),this.httpClient=new pe(this.window),this.journeyManagerService=new Yi,this.placementsRegister=new ls,this.launcherEventsService=new Ai,this.coreControllerPromise=t,this.launcherWindowService=new ln(this.coreControllerPromise,this.errorServicePromise.promise),this.firstPartyRecogniserAccessor=new Ne(this.launcherWindowService.getCookiesService(),this.launcherWindowService.getLocalStorageService()),this.referralService=new Cn,this.sessionCookieService=new Ln(this.launcherWindowService.getCookiesService(),this.partnerConfigService,this.launcherEventsService),this.sessionService=new Pe(this.sessionStorageService,this.partnerConfigService,this.environmentConfigService,this.errorServicePromise.promise,this.sessionCookieService),this.webApiService=new us({httpClient:this.httpClient,sessionService:this.sessionService,envConfig:this.environmentConfigService,partnerService:this.partnerConfigService,contextService:this.contextService,integrationConfigurationService:this.integrationConfigurationService}),this.loggingService=new Pn(this.webApiService,this.integrationConfigurationService,this.environmentConfigService),this.errorService=new ws(this.webApiService,this.environmentConfigService,this.integrationConfigurationService,this.contextService,this.loggingService),this.attributesService=new Pi(this.errorService),this.rdnMetricEventService=new Oi(this.webApiService,this.sessionService,this.contextService,this.loggingService,this.errorService),this.rdnEventService=new Ii(this.webApiService,this.sessionService,this.errorService,this.contextService),this.locationChangeTrackService=new mn(this.launcherWindowService.getLocationService()),this.metricsService=new Ps(this.locationChangeTrackService,this.webApiService,this.errorService,this.contextService,this.integrationConfigurationService),this.recogniserService=new Ie(this.partnerConfigService,this.firstPartyRecogniserAccessor,this.thirdPartyRecogniserAccessor),this.advertiserPageService=new Un(this.rdnEventService),this.roktPluginFactory=function({attributesService:t,contextService:e,errorService:s,sessionService:i,advertiserPageService:n,placementsRegister:r}){return async function(s){let r;return r=s.parent?o(s.parent.id).createChildPlacement(s):o(s.id),new Rn(r,i,e,t,n)};function o(t){const e=r.get(t);if(!e){const e=new l({code:y.PLACEMENT_NOT_FOUND,severity:u.ERROR,additionalInformation:{placementId:t}});s.throw(e)}return e}}(this),this.selectionContainerFactory=async e=>{const s=await t;return new bi(this,s,e)},this.selectionMiddlewareService=new ei,this.selectionService=new _i({environmentConfigService:this.environmentConfigService,errorService:this.errorService,launcherWindowService:this.launcherWindowService,metricsService:this.metricsService,partnerConfigService:this.partnerConfigService,recogniserService:this.recogniserService,referralService:this.referralService,sessionService:this.sessionService,selectionContainerFactory:this.selectionContainerFactory,selectionMiddlewareService:this.selectionMiddlewareService,webApiService:this.webApiService,performanceService:this.performanceService,contextService:this.contextService,attributesService:this.attributesService,launcherEventsService:this.launcherEventsService}),this.partnerValidationService=new An(this.selectionService),this.signalManagementService=new Mn(this.rdnEventService,this.partnerConfigService,this.selectionService),this.placementMonitoringService=new Ci(new Li(t,this.errorService),new Mi(t,this.errorService),new xi)}}async function $n(t){if(t===t.top)return;const e=new M,s=new jn(e.promise),i=ie({windowRef:t,createLauncherExtension:un(s,e.promise),pluginLibraryFactory:s.roktPluginFactory});Promise.race([i.then((async t=>(await t.connection.onReady(),t))),x(13e3)]).then((t=>async function(t,e){if(!t){!function(){const t=wn("",d.CONTROLLER_CONNECTION_TIMEOUT,d.CONTROLLER_CONNECTION_TIMEOUT,u.INFO);(0,v.reportError)(t)}();const t=await e;await t.connection.onReady(),function(){const t=wn("",d.LATE_CONTROLLER_CONNECTION,d.LATE_CONTROLLER_CONNECTION,u.INFO);(0,v.reportError)(t)}()}}(t,i))).catch(dn);try{const t=await i;await t.connection.onReady(),e.resolve(t),t.onError().subscribe((t=>{const e=f(t);s.errorService.report(e)}))}catch(t){dn(t)}!async function(t){try{const e=await t.launcherWindowService.getLocationService(),s=await e.getHref(),i=new URL(s).origin;t.contextService.setPartnerUrl(i)}catch(t){}}(s),function(t,e){var s;const i=t;null===(s=i.roktReporter)||void 0===s||s.set(e.report.bind(e))}(t,s.errorService)}!function(){L();$n(o())}()})()})();</script>

</body></html>